{"id":"te-0bw","title":"Make GitRunner.get_diffs_batch return all requested hashes in merge/non-linear history","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:32.01926+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:46:33.489325+01:00","closed_at":"2026-02-16T02:46:33.489325+01:00","close_reason":"Closed"}
{"id":"te-0d6","title":"Review remediation: fix CLI/runtime/data integrity regressions","description":"Track all findings from principal review (Feb 2026) and restore expected Town Elder CLI behavior, data integrity, and maintainability.","acceptance_criteria":"All child issues closed; te query/status/export/index/commit-index/hook workflows validated by tests; no known critical regressions remain.","notes":"Behavior-driven review run on 2026-02-15: 15/15 CLI workflow scenarios passed in isolated temp repos (init/add/search/query/index/commit-index/hook/export/stats guardrails). Full test suite also passed (63/63). Remaining high-priority gaps are focused in edge-case correctness and safety, tracked in te-qi6, te-zda, te-hxw, and te-0d6.13.","status":"closed","priority":1,"issue_type":"epic","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:19:25.423736+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:04:40.138717+01:00","closed_at":"2026-02-15T16:04:40.138717+01:00","close_reason":"Closed"}
{"id":"te-0d6.1","title":"Fix query and status alias commands crashing at runtime","description":"te query and te status crash with AttributeError because alias handlers call search.callback and stats.callback instead of shared helper functions.","acceptance_criteria":"te query and te status execute successfully with no AttributeError; add CLI regression tests covering both aliases.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:12.514051+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813376+01:00","closed_at":"2026-02-15T00:42:03.318726+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.1","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:12.515127+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.10","title":"Fix ZvecStore insert contract to avoid silent zero vectors","description":"The public ZvecStore insert API stores zero vectors, producing non-semantic retrieval behavior for callers that use this path.","acceptance_criteria":"Insert path cannot silently store zero vectors unless explicitly requested as fallback; API contract and tests document and verify expected vector behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:40.959348+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816478+01:00","closed_at":"2026-02-15T09:41:00.026232+01:00","dependencies":[{"issue_id":"te-0d6.10","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:40.960248+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.11","title":"Stop swallowing indexing errors in IndexService","description":"IndexService index_file catches broad exceptions and returns None, hiding root causes and making indexing failures hard to diagnose.","acceptance_criteria":"Operational failures are surfaced or explicitly reported with actionable context; tests verify failure paths are visible to callers.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:46.497228+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820314+01:00","closed_at":"2026-02-15T09:58:51.374807+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.11","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:46.498172+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.12","title":"Add regression tests for critical CLI and indexing workflows","description":"Current tests miss key regressions: alias command crashes, export default format, init force semantics, hook execution portability, and commit-index state safety across failures.","acceptance_criteria":"Automated tests cover query and status aliases, export default invocation, init force behavior, generated hook execution, stale-state backlog scenarios, and failed-index retry semantics.","status":"closed","priority":1,"issue_type":"task","assignee":"Kalle Bylin","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:49.444666+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816182+01:00","closed_at":"2026-02-15T09:45:39.560919+01:00","dependencies":[{"issue_id":"te-0d6.12","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:49.445712+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.13","title":"Implement or remove non-functional search filter flags","description":"The CLI exposes --author, --path, and --since on te search/query, but current behavior does not apply filtering to results. This creates a gap between user expectations and actual behavior in agent workflows that need scoped retrieval.","acceptance_criteria":"1) Either implement --author/--path/--since filtering semantics or remove these flags from search/query. 2) No filter may be silently ignored: unsupported filters must error with clear guidance. 3) CLI help + README must match actual behavior. 4) Regression tests prove both filtered and unfiltered paths and verify no silent-ignore behavior.","notes":"Implemented: Removed non-functional --author, --path, --since flags from te search/query commands. CLI help now accurately reflects available options. Tests updated and passing.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:48:30.302575+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:05:16.773737+01:00","closed_at":"2026-02-15T15:30:00+01:00","dependencies":[{"issue_id":"te-0d6.13","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T11:48:30.304328+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.2","title":"Prevent commit-index state advancement when indexing fails","description":"commit-index updates index_state.json even when commits fail to embed or store, which can permanently skip unindexed commits on later runs.","acceptance_criteria":"State only advances for successfully indexed frontier; failed commits remain retryable; regression test verifies failure then retry indexes skipped commits.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:15.447623+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.81308+01:00","closed_at":"2026-02-15T00:42:13.604651+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.2","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:15.448558+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.3","title":"Make init --force semantics truthful and safe","description":"te init --force currently reports reinitialization but preserves prior indexed data. Implement real reset behavior or adjust UX to be explicitly non-destructive.","acceptance_criteria":"Behavior and messaging are consistent: either data is actually reinitialized or help text explicitly indicates non-destructive operation; tests assert expected document count behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:18.41905+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817992+01:00","closed_at":"2026-02-15T01:11:33.927802+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.3","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:18.419895+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.4","title":"Generate robust post-commit hook command invocation","description":"Generated hooks call bare te and can fail in uv or pyenv environments. Hook command construction should avoid PATH assumptions and handle quoted paths safely.","acceptance_criteria":"Installed hook executes reliably without global PATH assumptions, including data directory paths with spaces; test executes generated hook script in a temp repo.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:21.346811+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817745+01:00","closed_at":"2026-02-15T01:11:33.997381+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.4","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:21.347695+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.5","title":"Fix Town Elder hook detection when command includes extra args","description":"Hook ownership detection checks a brittle te commit-index substring and misclassifies valid Town Elder hooks that include extra args such as --data-dir.","acceptance_criteria":"hook status and hook uninstall correctly recognize Town Elder-managed hooks with and without extra arguments; regression tests cover both forms.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:25.863662+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817504+01:00","closed_at":"2026-02-15T01:11:34.06662+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.5","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:25.864527+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.6","title":"Fix incremental backlog loss when last indexed commit is missing","description":"If last indexed commit is absent from scanned history, incremental mode may index only the first page limit and still advance state, leaving older backlog unindexed.","acceptance_criteria":"When sentinel commit is missing or stale, behavior is deterministic and safe with no silent partial indexing and no unsafe state advance; tests cover backlog larger than limit.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:29.625223+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817233+01:00","closed_at":"2026-02-15T09:17:17.726496+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.6","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:29.626174+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.7","title":"Make file indexing idempotent by default with stable IDs","description":"Directory indexing currently uses random UUIDs for file documents, so repeated runs duplicate unchanged content and inflate document count.","acceptance_criteria":"Default indexing uses stable document identity and upsert semantics; rerunning index on unchanged files does not increase document count; append behavior is explicit if retained.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:32.385205+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816988+01:00","closed_at":"2026-02-15T09:36:16.387252+01:00","dependencies":[{"issue_id":"te-0d6.7","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:32.386167+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.8","title":"Remove implicit home fallback for default data directory","description":"Current config falls back to a home-level te directory when local te storage is absent, which can cross-contaminate repositories and surprise users.","acceptance_criteria":"Default behavior is repository-local and explicit; no implicit global fallback unless user opts in; documentation and tests updated for the new semantics.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:35.1938+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816746+01:00","closed_at":"2026-02-15T09:53:25.141265+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.8","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:35.19505+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.9","title":"Eliminate module-global data-dir leakage across CLI invocations","description":"CLI stores selected data directory in module-global state, which leaks across in-process invocations and causes stale configuration behavior in tests and embedded use.","acceptance_criteria":"Data directory resolution is invocation-scoped; repeated in-process calls without data-dir do not inherit stale prior values; regression test added.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:38.039634+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820569+01:00","closed_at":"2026-02-15T10:27:15.299033+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.9","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:38.041128+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0dh","title":"Update stale context docs that still reference Replay paths and commands","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:45.847981+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T23:52:54.003984+01:00","closed_at":"2026-02-15T23:52:54.003984+01:00","close_reason":"Closed"}
{"id":"te-0na","title":"hook install follows symlink and can overwrite arbitrary files","description":"## Summary\n`te hook install --force` writes directly to `.git/hooks/post-commit` with `Path.write_text()` and does not protect against symlink targets.\nIf `post-commit` is a symlink, install overwrites the symlink target outside `.git/hooks`.\n\n## Impact\nSecurity vulnerability (arbitrary file overwrite) when running in an untrusted or partially compromised repository.\n\n## Reproduction\n1. Create a git repo and initialize Town Elder data dir.\n2. Create `.git/hooks/post-commit` as a symlink to another file (e.g. `/tmp/sensitive.txt`).\n3. Run:\n   `python -m town_elder --data-dir \u003cdata_dir\u003e hook install --repo \u003crepo\u003e --force`\n4. Observe the target file content is replaced by hook script content.\n\nI reproduced this locally: target file contents were overwritten while `post-commit` remained a symlink.\n\n## Expected\nHook installation should refuse symlinked hook paths, or safely replace the symlink inode without following it.\n\n## Actual\nThe symlink target file is overwritten.\n\n## Code References\n- `src/town_elder/cli/__init__.py:1124`\n- `src/town_elder/cli/__init__.py:1130`\n- `src/town_elder/cli/__init__.py:1172`","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:32:05.205148+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:31:56.81969+01:00","closed_at":"2026-02-16T17:31:56.81969+01:00","close_reason":"Closed"}
{"id":"te-102","title":"[Rust Shared Core] Wire Rust path into `te index files` behind feature flag","description":"Integrate Rust-backed scanning/parsing helpers into `te index files` path behind feature flag.\n\nScope:\n- Route file scanning, chunk parsing, and deterministic helper calls through adapter when enabled.\n- Preserve batching, embedding, and storage write behavior currently in Python.\n- Preserve incremental state and deletion semantics.\n\nCode areas:\n- src/town_elder/cli/__init__.py (`index_files` flow)\n- src/town_elder/indexing/pipeline.py (adapter integration boundaries)\n- src/town_elder/indexing/file_scanner.py (fallback path retained)\n- tests/test_index_files_incremental_regressions.py\n- tests/test_indexing_pipeline.py","design":"Do not change embed/store batch behavior in this ticket; only upstream parsing/scanning is swapped.","acceptance_criteria":"- With flag off, existing behavior and tests remain unchanged.\n- With flag on (test environment), Rust path is exercised and produces equivalent indexed outputs.\n- Incremental skip/delete and metadata regression tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:05.910239+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:42:16.886946+01:00","closed_at":"2026-02-18T23:42:16.886946+01:00","close_reason":"Closed","labels":["indexing","python","rust"],"dependencies":[{"issue_id":"te-102","depends_on_id":"te-pqp","type":"blocks","created_at":"2026-02-17T18:51:22.151819+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-102","depends_on_id":"te-7nz","type":"blocks","created_at":"2026-02-17T18:51:32.423196+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-102","depends_on_id":"te-f97","type":"blocks","created_at":"2026-02-17T18:51:42.595114+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-102","depends_on_id":"te-8dz","type":"blocks","created_at":"2026-02-17T18:51:52.960863+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-102","depends_on_id":"te-ee5","type":"blocks","created_at":"2026-02-17T18:52:03.23547+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-143","title":"Align CLI surface with spec: query/status commands and filters","description":"Implementation exposes search/stats but design docs define query/status and query filters (--since, --author, --path). This creates UX/docs drift.","acceptance_criteria":"Either implement query/status aliases and required filters or formally update specs/docs/tests to declared command contract; help output and README stay consistent.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:23.875406+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821692+01:00","closed_at":"2026-02-14T23:47:26.727539+01:00","close_reason":"Closed"}
{"id":"te-14z","title":"te-git-hook-management","description":"Implement post-commit hook install/uninstall functionality","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.244496+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825086+01:00","closed_at":"2026-02-14T13:57:40.876944+01:00","close_reason":"Git hook management implemented: te hook install/uninstall/status commands working","dependencies":[{"issue_id":"te-14z","depends_on_id":"te-5n1","type":"blocks","created_at":"2026-02-13T21:57:00.658255+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-15d","title":"Rename project to Town Elder, package to town-elder, CLI to te","description":"Rename and rebrand the project from Town Elder to Town Elder.\n\nTarget naming:\n- Product/project name: Town Elder\n- Python distribution/package name: town-elder\n- Python import package: town_elder\n- CLI command: te\n\nThis is a cross-cutting rename touching package layout, entry points, imports, docs, generated hooks, tests, and user-facing output/messages.\n\nScope of required changes:\n1) Packaging and metadata\n- Update pyproject metadata (`[project].name`, description/keywords/classifiers as needed) to `town-elder`.\n- Update console script entry point so `te` is installed and points to the new package.\n- Ensure editable install and wheel/sdist metadata are coherent after rename.\n\n2) Python package/module rename\n- Rename source package from `src/te` to `src/town_elder`.\n- Update all internal imports and module references from `te.*` to `town_elder.*`.\n- Update `__main__` module entrypoints (`python -m town_elder`, `python -m town_elder.cli`) and any old hardcoded module invocations.\n\n3) CLI rename and behavior\n- Ensure CLI branding/help text uses Town Elder terminology.\n- Ensure command examples and output references no longer say `te` unless explicitly documenting compatibility.\n- Update git hook generation/uninstall detection logic so installed hooks invoke the new module/command correctly.\n\n4) Data-dir/config and compatibility strategy\n- Decide and implement compatibility policy for existing `.te` directories/config/state:\n  - either migrate/auto-detect `.te` and move to new location,\n  - or explicitly preserve `.te` for backward compatibility,\n  - or adopt a new default path with clear migration logic.\n- Document this policy clearly.\n\n5) Docs and references\n- Update README and relevant docs/context files to use Town Elder + `te` commands.\n- Update AGENTS/developer docs where command/package names are referenced.\n\n6) Tests and fixtures\n- Update tests that reference old module path/CLI name/output strings.\n- Add/adjust regression tests for:\n  - `uv run te --help`\n  - `python -m town_elder --help`\n  - hook scripts invoking the correct command/module\n  - chosen compatibility behavior for existing `.te` data.\n\n7) Cleanup\n- Remove stale references to old naming in user-facing paths/messages where intended.\n- Keep any intentional compatibility aliases explicitly documented and tested.","acceptance_criteria":"1) `uv run te --help` works and presents Town Elder branding.\n2) `python -m town_elder --help` and `python -m town_elder.cli --help` work.\n3) Distribution metadata identifies package as `town-elder`; imports use `town_elder`.\n4) All runtime imports and tests pass after package rename (no broken `te.*` imports in active code paths).\n5) Hook install/status/uninstall flows generate and detect hook commands for the new CLI/module naming.\n6) A clear migration/compatibility policy for existing `.te` data is implemented and documented.\n7) README and key contributor docs use Town Elder naming and `te` commands.\n8) Full quality gates pass (`uv run pytest`, lint if configured), and no critical rename regressions remain.","notes":"## Implementation Summary\n\n### Changes Made\n\n1. **Package Rename**:  -\u003e \n2. **Python Distribution**: Updated :\n   - Package name:  -\u003e \n   - Console script:  -\u003e \n   - isort known-first-party:  -\u003e \n\n3. **CLI Rebranding**:\n   - CLI name:  -\u003e \n   - All help text and user-facing messages updated\n   - Default data directory:  -\u003e \n\n4. **Import Updates**: All imports changed from  to \n\n5. **Hook Detection Updates**:\n   - Detection function renamed to \n   - Supports both new / hooks and legacy  hooks for backward compatibility\n\n6. **Backward Compatibility**:\n   -  directories are automatically detected and used\n   - Legacy  and  CLI invocations are supported\n   - Hooks generated by old CLI are still detected and managed\n   - zvec collection name kept as  for existing data compatibility\n\n7. **Documentation**:\n   - README updated with new branding and commands\n   - AGENTS.md updated with Town Elder - Semantic memory CLI\nUse --help for usage information command\n\n8. **Tests**: All test files updated to use new imports and commands\n\n### Quality Gates\n- All 65 tests pass\n- Ruff lint checks pass\n\n### Migration Behavior\n- Existing  directories are automatically detected and used\n- Users can continue using old hooks (they're detected as Town Elder hooks)\n- No automatic migration of data - existing  data is read in-place","status":"closed","priority":1,"issue_type":"epic","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:54:02.55356+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814684+01:00","closed_at":"2026-02-15T12:11:25.841941+01:00","close_reason":"Closed"}
{"id":"te-17p","title":"Make generated post-commit hooks work without requiring uv on PATH","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:15.157075+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:12:46.050317+01:00","closed_at":"2026-02-16T00:12:46.050317+01:00","close_reason":"Closed"}
{"id":"te-1cg","title":"Protect non-Town Elder hooks during uninstall","description":"Prevent te hook uninstall from deleting custom post-commit hooks by default.","acceptance_criteria":"1) te hook uninstall refuses to delete non-Town Elder hooks by default with clear message and non-zero exit. 2) --force explicitly allows deletion. 3) Behavior is covered by tests for Town Elder and non-Town Elder hook content.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:21.849963+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814153+01:00","closed_at":"2026-02-14T19:21:20.935716+01:00"}
{"id":"te-1gb","title":"te-setup-project-structure","description":"Create Python package structure with pyproject.toml, directory layout, and base modules","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:22.857833+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.830201+01:00","closed_at":"2026-02-13T22:45:45.366658+01:00"}
{"id":"te-1m9","title":"QueryService treats top_k=0 as 'unset' and silently uses default","description":"## Summary\n`QueryService.search()` uses `top_k = top_k or config.default_top_k`.\nThis treats `0` as falsy and replaces it with the default value instead of honoring caller intent or validating input.\n\n## Impact\nProgrammatic callers cannot reliably request `top_k=0` behavior and may get unexpected results.\nThe method also mixes validation semantics (silently coercing invalid/falsy input).\n\n## Reproduction\nWith `default_top_k=5`, call:\n`QueryService.search(\"q\", top_k=0)`\nObserved downstream store call uses `top_k=5`.\n\n## Expected\nEither:\n- respect explicit `top_k=0` (if supported), or\n- reject with validation error.\n\n## Actual\n`0` is silently converted to default.\n\n## Code References\n- `src/town_elder/services/query_service.py:24`","status":"closed","priority":3,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:34:30.96901+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:30:04.412096+01:00","closed_at":"2026-02-16T18:30:04.412096+01:00","close_reason":"Closed"}
{"id":"te-202","title":"[Rust Shared Core] Wire Rust path into `te index commits` behind feature flag","description":"Integrate Rust-backed commit parsing helpers into `te index commits` flow behind feature flag.\n\nScope:\n- Route commit text preparation and diff parsing through adapter when enabled.\n- Keep frontier/sentinel state persistence logic in Python unchanged.\n- Preserve current retry/fallback behavior.\n\nCode areas:\n- src/town_elder/cli/__init__.py (`_run_commit_index`)\n- src/town_elder/git/runner.py (fallback path retained)\n- src/town_elder/git/diff_parser.py (fallback path retained)\n- tests/test_cli_regressions.py\n- tests/test_git_runner.py","design":"Keep storage API usage identical (doc ids and metadata keys unchanged).","acceptance_criteria":"- Flag-off path keeps current commit indexing behavior.\n- Flag-on path is covered by tests and preserves state advancement semantics.\n- No regressions on duplicate commit detection and batch checkpointing behavior.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:17.659667+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T20:41:56.179863+01:00","closed_at":"2026-02-18T20:41:56.179865+01:00","labels":["commits","python","rust"],"dependencies":[{"issue_id":"te-202","depends_on_id":"te-7nz","type":"blocks","created_at":"2026-02-17T18:52:13.406356+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-202","depends_on_id":"te-d0q","type":"blocks","created_at":"2026-02-17T18:52:23.709735+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-202","depends_on_id":"te-ee5","type":"blocks","created_at":"2026-02-17T18:52:33.895351+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-277","title":"Add a --version flag and consistent machine-readable metadata output for CLI","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:31.839932+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:44:56.26972+01:00","closed_at":"2026-02-16T00:44:56.26972+01:00","close_reason":"Closed"}
{"id":"te-27w","title":"commit-index on empty repo prints raw git command error instead of no-commits result","description":"## Summary\nRunning `te commit-index` on an initialized but empty git repository (no commits yet) returns an opaque subprocess error containing raw git command details.\n\n## Reproduction\n1. `git init` a new repo with no commits.\n2. Run `te init`.\n3. Run `te commit-index --limit 10`.\n\nObserved: `Error fetching commits: Command ['git', ... \"log\", ...] returned non-zero exit status 128.`\nExpected: user-friendly output like \"No commits to index\" (exit 0) or a clear structured message without internal command dump.\n\n## Evidence\n`commit_index()` catches all fetch errors and prints `str(e)` from `CalledProcessError`, leaking raw subprocess internals to the CLI.\n\n## Impact\nPoor first-run UX in new repositories and confusing automation logs.","status":"closed","priority":3,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:37.14874+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T04:13:27.759902+01:00","closed_at":"2026-02-16T03:20:58Z"}
{"id":"te-2st","title":"Simplify commit-index mode flags for readability","description":"`te commit-index --help` currently combines multiple overlapping mode controls: `--all`, `--incremental/--full`, and `--force`. The `--incremental --full` paired flag presentation is especially hard to parse in help output, and users must infer interactions between options.","acceptance_criteria":"- Replace overlapping boolean mode flags with a clearer model (for example, an explicit mode option and orthogonal toggles).\n- Help output explains exactly how full-history, incremental, and reindex behaviors interact.\n- Invalid or conflicting combinations are either impossible by design or produce a clear error message.","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:33:10.67908+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:25:50.330673+01:00","labels":["cli","ux"]}
{"id":"te-2x2","title":"Consolidate duplicated CLI logic into a clear canonical service layer","description":"## Summary\nThe codebase has service abstractions (`IndexService`, `QueryService`), but core CLI commands implement duplicate indexing/query logic directly. This architectural split increases maintenance cost and risk of behavior drift.\n\n## Why This Matters\n- Business logic spread across CLI and service layer creates inconsistency risk.\n- Bug fixes can land in one path and miss the other.\n- Testing burden increases because behavior is duplicated.\n\n## Current Implementation\nService layer:\n- `src/town_elder/services/index_service.py:13`\n- `src/town_elder/services/query_service.py:9`\n\nCLI duplicates logic instead of using services:\n- `src/town_elder/cli/__init__.py:495` (`index` command)\n- `src/town_elder/cli/__init__.py:604` (`commit_index` command)\n- `src/town_elder/cli/__init__.py:371` (`search`/`query` via helper)\n- `src/town_elder/cli/__init__.py:407` (`add` command)\n\n## Problem Detail\n- `IndexService` and `QueryService` are lightly used or bypassed.\n- CLI performs embedding/store orchestration directly in multiple commands.\n- It is unclear which layer is canonical for core behavior.\n\n## Proposed Change\nChoose and enforce a single architecture direction:\n1. Preferred: make service layer canonical and have CLI delegate to services.\n2. Alternative: remove unused service abstractions if not needed.\n\nIf choosing service-first:\n- Introduce dedicated application services for `add`, `index`, `search`, `commit-index`, `export`, and hook management as appropriate.\n- Keep CLI focused on argument parsing, output formatting, and exit codes.\n\n## Tests To Add/Update\n- Add/adjust unit tests for service methods that now carry canonical logic.\n- Keep CLI integration tests focused on command wiring and UX.\n- Ensure no behavior regression in existing command outputs and error handling.\n\n## Acceptance Criteria\n- Core indexing/query behavior is implemented in one canonical layer.\n- CLI no longer duplicates substantive business logic.\n- Test suite reflects the chosen layering strategy and passes.\n","notes":"Execution order: Phase 4/4 final cleanup. Depends on te-lm6, te-68r, te-zps, te-xe2, and te-4lm.\nRecommended rollout sequence: (1) te-lm6 + te-68r in parallel, (2) te-zps + te-xe2, (3) te-4lm, (4) te-2x2.","status":"closed","priority":3,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:45:25.73865+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T22:28:37.688702+01:00","closed_at":"2026-02-15T22:28:37.688702+01:00","close_reason":"Closed","labels":["phase-4"],"dependencies":[{"issue_id":"te-2x2","depends_on_id":"te-lm6","type":"blocks","created_at":"2026-02-15T17:48:16.494174+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-68r","type":"blocks","created_at":"2026-02-15T17:48:26.817151+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-xe2","type":"blocks","created_at":"2026-02-15T17:48:37.155954+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-zps","type":"blocks","created_at":"2026-02-15T17:48:47.402559+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-4lm","type":"blocks","created_at":"2026-02-15T17:48:57.737407+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-3vg","title":"index_state updates are non-atomic and lose data under concurrent writers","description":"## Summary\n`_save_index_state()` performs read-modify-write on `index_state.json` with no lock and no atomic replace.\nConcurrent writers race and overwrite each other, dropping repo entries.\n\n## Impact\nData loss in incremental cursor state when multiple `commit-index` processes/hook runs write at the same time.\nThis is a race condition and can silently regress indexing continuity.\n\n## Reproduction\nI reproduced with 30 threads hitting `_save_index_state()` concurrently (barrier-synchronized) against the same state file.\nExpected 30 repo entries, observed only 1 entry after completion (`lost (0, 1)` on first trial).\n\n## Expected\nState updates should be serialized (file lock/mutex) and persisted atomically (temp file + rename) so concurrent writers cannot lose entries.\n\n## Actual\nLast-writer-wins behavior drops previously written repo state.\n\n## Code References\n- `src/town_elder/cli/__init__.py:317`\n- `src/town_elder/cli/__init__.py:319`\n- `src/town_elder/cli/__init__.py:341`","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:32:47.516652+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:53:10.734863+01:00","closed_at":"2026-02-16T17:53:10.734863+01:00","close_reason":"Closed"}
{"id":"te-3ya","title":"Fix commit-index embedder API regression with injected embedders","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:21.661077+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:46:33.490778+01:00","closed_at":"2026-02-16T02:46:33.490778+01:00","close_reason":"Closed"}
{"id":"te-45a","title":"te-embedder-wrapper","description":"Implement fastembed wrapper with lazy loading, model selection support, and batch embedding capabilities","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:33.660462+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829697+01:00","closed_at":"2026-02-13T22:46:12.055793+01:00","dependencies":[{"issue_id":"te-45a","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:47.278877+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-4g6","title":"Remove tracked bytecode artifacts from repository","description":"Repository currently tracks __pycache__ and .pyc files, causing noisy diffs and nondeterministic churn.","acceptance_criteria":"1) Remove tracked bytecode artifacts from git index. 2) Keep ignore rules preventing reintroduction. 3) Add lightweight guard (test/script/CI check) to block tracked bytecode files.","status":"closed","priority":2,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:25.192363+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822344+01:00","closed_at":"2026-02-14T22:50:01.164768+01:00"}
{"id":"te-4gz","title":"Repair get_config clear_cache behavior","description":"get_config(clear_cache=True) currently raises AttributeError due missing cache decorator.","acceptance_criteria":"1) clear_cache path works without exception. 2) Config caching behavior is explicit and tested.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:13.249847+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823203+01:00","closed_at":"2026-02-14T22:22:14.28835+01:00"}
{"id":"te-4lm","title":"Improve commit-index scalability for long-lived repositories","description":"## Summary\n`commit-index` does not scale well to long-lived repositories (thousands+ commits). The current design performs many per-commit subprocess operations and embeds full diffs, making full-history indexing slow and resource-heavy.\n\n## Why This Matters\nTown Elderâ€™s value proposition includes semantic recall of commit history. For mature repos, current indexing cost can become prohibitive, reducing adoption and trust.\n\n## Current Behavior and Constraints\n- Default limit is 100 commits unless user manually increases it.\n- Incremental sentinel search paginates, but indexing still processes full commit diffs one commit at a time.\n- Many subprocess calls are made per commit.\n\n## Current Implementation Hotspots\nFiles:\n- `src/town_elder/cli/__init__.py:674`\n- `src/town_elder/cli/__init__.py:700`\n- `src/town_elder/cli/__init__.py:746`\n- `src/town_elder/git/runner.py:89`\n- `src/town_elder/git/runner.py:111`\n\nObserved inefficiencies:\n1. `GitRunner.get_commits()` calls `_get_commit_files()` per commit (N+1 git invocations).\n2. `commit-index` calls `git show` per commit for full diff text.\n3. No explicit resumable checkpoint for long full-history runs beyond last indexed frontier semantics.\n\n## Proposed Change\nImplement a scalable indexing path for long histories:\n1. Add explicit CLI controls for depth and batching:\n   - `--all` to index full reachable history.\n   - `--batch-size \u003cn\u003e` for bounded processing chunks.\n2. Reduce subprocess overhead:\n   - Fetch commit metadata in batch-friendly git calls.\n   - Avoid per-commit extra calls where possible.\n3. Add resumable progress checkpoints:\n   - Persist cursor/progress after each batch.\n   - Allow safe resume after interruption.\n4. Bound payload size:\n   - Add safeguards for very large diffs (e.g., truncation policy with metadata markers) so embeddings remain tractable.\n5. Improve user feedback:\n   - Progress output (`indexed X/Y`, current batch, ETA-ish timing where feasible).\n\n## Tests To Add/Update\n- Integration-like test using mocked large commit sets to verify batch/resume behavior.\n- Regression tests ensuring interruption + rerun resumes without duplicate state corruption.\n- Performance-oriented unit tests around reduced git command invocation count (can be mock-based).\n\n## Acceptance Criteria\n- Users can reliably index full history for old repos using `--all` + batching.\n- Interrupted runs can resume without restarting from zero.\n- Command invocation count and runtime characteristics improve relative to current behavior.\n- Existing incremental safety behavior remains intact.\n","notes":"Execution order: Phase 3/4. Depends on te-zps and te-xe2.","status":"closed","priority":2,"issue_type":"feature","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:44:35.762434+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T21:06:43.337321+01:00","closed_at":"2026-02-15T21:06:43.337321+01:00","close_reason":"Closed","labels":["phase-3"],"dependencies":[{"issue_id":"te-4lm","depends_on_id":"te-zps","type":"blocks","created_at":"2026-02-15T17:47:55.830436+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-4lm","depends_on_id":"te-xe2","type":"blocks","created_at":"2026-02-15T17:48:06.159265+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-4mk","title":"commit-index fails when --repo points to a repo subdirectory","description":"## Summary\n`commit-index` rejects valid repository subdirectories, so running from inside a repo (default `--repo .`) fails unless you point to the repo root.\n\n## Reproduction\n1. Create a git repo with at least one commit and initialize TE in repo root.\n2. `cd` into a subdirectory inside that repo.\n3. Run:\n   ```bash\n   /Users/bylin/Code/town_elder/.venv/bin/te --data-dir \u003crepo\u003e/.town_elder commit-index\n   ```\n   or explicitly:\n   ```bash\n   /Users/bylin/Code/town_elder/.venv/bin/te --data-dir \u003crepo\u003e/.town_elder commit-index --repo \u003crepo\u003e/subdir\n   ```\n\n## Expected\nThe command should treat subdirectories as valid repo paths (like `git -C \u003csubdir\u003e ...` does).\n\n## Actual\nExits with:\n`Error: Not a git repository ... Ensure the path contains a .git directory`\n\n## Suspected Cause\nValidation requires `(repo_path / \".git\").exists()`, which is false for subdirectories inside a valid repository (`src/town_elder/cli/__init__.py:795`).\n","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T07:14:22.661897+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T08:26:05.902704+01:00","closed_at":"2026-02-16T08:26:05.902706+01:00"}
{"id":"te-4o1","title":"commit-index crashes on non-UTF8 git output","description":"## Summary\n`commit-index` can fail with a Unicode decode error while reading Git output for repositories that contain non-UTF8/binary patch content.\n\n## Reproduction\n1. Initialize a fresh TE data dir.\n2. Run:\n   ```bash\n   /Users/bylin/Code/town_elder/.venv/bin/te --data-dir \u003cfresh-data-dir\u003e commit-index --repo /Users/bylin/Code/town_elder --limit 100\n   ```\n\n## Expected\nCommit indexing should proceed, skipping or safely decoding binary/non-UTF8 diff payloads.\n\n## Actual\nFails early with:\n`'utf-8' codec can't decode byte 0x80 ... invalid start byte`\n\n## Suspected Cause\n`GitRunner._run_git` uses `subprocess.run(..., text=True)` with strict UTF-8 decode and no error strategy, so binary output from git patch/log operations can crash the command (`src/town_elder/git/runner.py:54`).\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T07:14:22.559708+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:26:43.463747+01:00","closed_at":"2026-02-16T07:26:43.463747+01:00","close_reason":"Closed"}
{"id":"te-4vw","title":"IndexService.index_file leaks UnicodeDecodeError instead of IndexingError","description":"IndexService.index_file wraps OSError from read_text but not UnicodeDecodeError. Invalid UTF-8 content therefore escapes as UnicodeDecodeError instead of IndexingError. index_directory only aggregates IndexingError, so one bad-encoding file can bypass error aggregation and abort directory indexing unexpectedly.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.709201+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:20.946936+01:00","closed_at":"2026-02-16T06:08:20.946939+01:00"}
{"id":"te-53y","title":"Fix README onboarding accuracy (source clone URL and pip vs uv workflows)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:00.257595+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:36:47.861109+01:00","closed_at":"2026-02-16T00:36:47.861109+01:00","close_reason":"Closed"}
{"id":"te-54z","title":"[Distribution] Add Homebrew/direct-install path for native `te-rs`","description":"Add Homebrew/direct binary distribution path for native `te-rs`.\n\nScope:\n- Publish install instructions and checksum workflow.\n- Add Homebrew tap formula and update process docs.\n- Verify install and smoke test on macOS target.\n\nCode areas:\n- Formula/te-rs.rb (new, in tap repo or documented path)\n- docs/distribution-homebrew.md (new)\n- README.md distribution section","design":"If tap lives in separate repo, include exact ownership and update workflow in docs.","acceptance_criteria":"- Homebrew install path is documented end-to-end.\n- Formula references release artifacts and checksums correctly.\n- Smoke test command documented and validated.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:58.63335+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:42:31.374699+01:00","closed_at":"2026-02-18T23:42:31.374699+01:00","close_reason":"Closed","labels":["distribution","homebrew","rust"],"dependencies":[{"issue_id":"te-54z","depends_on_id":"te-tsf","type":"blocks","created_at":"2026-02-17T18:54:06.252238+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-5a8","title":"Improve filesystem indexing accounting and exclusion controls","description":"index recursively scans all .py/.md files without exclusion (e.g., .venv/.git) and reports attempted count as indexed count even when many files are skipped.","acceptance_criteria":"Add exclusion rules/configuration; report attempted/indexed/skipped accurately; add tests covering unreadable/binary/ignored paths.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:54.741155+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821056+01:00","closed_at":"2026-02-14T23:47:26.715987+01:00","close_reason":"Closed"}
{"id":"te-5c3","title":"[Rust Shared Core] Define interop contract and parity fixtures","description":"Define the Rust shared-core interoperability contract before implementation.\n\nScope:\n- Specify canonical input/output DTOs shared by Python and Rust for:\n  - file scanning results\n  - parsed file chunks + metadata\n  - commit log parsing records\n  - diff-to-text output\n  - deterministic doc-id helpers\n- Add fixture cases covering edge behavior currently relied on in Python.\n\nCode areas:\n- docs/rust-shared-core-contract.md (new)\n- tests/fixtures/rust_core_contract/ (new)\n- tests/ (new parity fixture loader tests)\n- src/town_elder/cli/__init__.py (reference current behavior only; do not change runtime behavior)","design":"Use this ticket as the source of truth for all Rust parity checks. Favor explicit examples over prose.","acceptance_criteria":"- Contract document exists and enumerates every shared DTO field and normalization rule.\n- Fixture set includes at least: quoted git diff paths with spaces, unicode commit subject, rst directives/temporal tags, chunk index normalization, doc-id hashing inputs.\n- New tests validate fixture shape and expected outputs against current Python behavior.\n- No user-visible behavior changes in CLI commands.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:46:42.1657+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T19:20:40.780701+01:00","closed_at":"2026-02-17T19:20:40.780701+01:00","close_reason":"Closed","labels":["interop","planning","rust"]}
{"id":"te-5n1","title":"te-git-runner","description":"Implement git command execution: get commits, get diffs, commit range","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:43.194978+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825322+01:00","closed_at":"2026-02-13T22:45:51.316719+01:00"}
{"id":"te-66w","title":"Fail fast when embedding backend is unavailable","description":"Do not silently degrade to zero vectors when fastembed cannot be imported.","acceptance_criteria":"1) Missing fastembed raises explicit user-facing error with remediation steps. 2) Any fallback mode is opt-in and clearly indicated. 3) Tests cover missing-backend behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:52.686143+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819427+01:00","closed_at":"2026-02-14T19:27:30.157266+01:00"}
{"id":"te-68r","title":"Make generated git hooks robust to pyenv/uv interpreter resolution","description":"## Summary\nGenerated `post-commit` hooks currently invoke Town Elder with `python -m town_elder ...`. In some common `pyenv`/`uv` environments, `python` is not available on PATH at commit time, causing silent hook failure and missed indexing.\n\n## Why This Matters\n- Automatic commit indexing is a core workflow feature.\n- Hook failures are easy to miss because commits still succeed.\n- Users think history is indexed when it is not.\n\n## Evidence\nObserved during end-to-end hook test:\n- Hook content used:\n  ```sh\n  python -m town_elder --data-dir \"...\" commit-index --repo \"$(git rev-parse --show-toplevel)\"\n  ```\n- Commit-time output included:\n  ```text\n  pyenv: python: command not found\n  ```\n- `index_state.json` was not created after commit (hook did not index).\n\n## Current Implementation\nFiles:\n- `src/town_elder/cli/__init__.py:356`\n- `src/town_elder/cli/__init__.py:358`\n- `src/town_elder/cli/__init__.py:847`\n- `src/town_elder/cli/__init__.py:852`\n\nRelated test signal:\n- `tests/test_cli_regressions.py:442`\n- `tests/test_cli_regressions.py:447`\n\nThe integration test currently rewrites the hook to `uv run te ...`, which indicates default generated hook behavior is not robust in the test/runtime environment.\n\n## Reproduction\n1. Initialize repo and Town Elder with hook installation.\n2. Make a commit.\n3. Observe hook stderr (`python: command not found`) and missing `index_state.json`.\n\n## Proposed Change\nImplement a robust launcher in generated hook scripts. Recommended approach:\n1. Capture installer runtime interpreter path (`sys.executable`) and generate hook using that absolute interpreter:\n   ```sh\n   \"\u003cabsolute-python\u003e\" -m town_elder ...\n   ```\n2. Optionally add fallback logic (`te` command if available) with clear failure output.\n3. Keep path quoting for `--data-dir` and repo path safety.\n4. Ensure behavior is consistent for:\n   - `te init --install-hook`\n   - `te hook install`\n\n## Tests To Add/Update\n- End-to-end hook integration test that uses the generated hook as-is (no rewrite) and verifies commit creates/updates `index_state.json`.\n- Unit/integration tests for hook content generation under explicit `--data-dir` and default data-dir.\n\n## Acceptance Criteria\n- Generated hooks execute successfully in pyenv/uv-managed envs where bare `python` may not exist.\n- A real commit triggers commit indexing and updates `index_state.json`.\n- Hook content generation is covered by regression tests.\n","notes":"Execution order: Phase 1/4. Can be implemented immediately in parallel with te-lm6.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:43:49.834213+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:13:37.648611+01:00","closed_at":"2026-02-15T18:13:37.648611+01:00","close_reason":"Closed","labels":["phase-1"]}
{"id":"te-6ck","title":"[Validation] Benchmark parity and define Rust rollout gate","description":"Run parity + performance validation and decide rollout state of Rust paths.\n\nScope:\n- Compare Python vs Rust-enabled flows for:\n  - `index files`\n  - `index commits`\n  - query latency baseline\n- Extend benchmark harness to capture Rust path measurements.\n- Produce rollout decision: default-off, opt-in, or default-on criteria.\n\nCode areas:\n- scripts/benchmark_indexing.py\n- django_town_elder_benchmark.md (or new benchmark report artifacts)\n- tests/test_benchmark_harness.py\n- docs/indexing.md\n- docs/rust-rollout.md (new)","design":"Use this as the release gate before enabling Rust path by default.","acceptance_criteria":"- Benchmark report includes Python baseline vs Rust-enabled results with reproducible commands.\n- Functional parity checklist is completed and linked to test runs.\n- Rollout decision and gating criteria are documented.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:49:08.922511+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:42:36.451554+01:00","closed_at":"2026-02-18T23:42:36.451554+01:00","close_reason":"Closed","labels":["benchmark","rollout","rust"],"dependencies":[{"issue_id":"te-6ck","depends_on_id":"te-102","type":"blocks","created_at":"2026-02-17T18:54:16.616315+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-6ck","depends_on_id":"te-202","type":"blocks","created_at":"2026-02-17T18:54:26.978874+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-6ck","depends_on_id":"te-nqf","type":"blocks","created_at":"2026-02-17T18:54:37.243684+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-6ck","depends_on_id":"te-tsf","type":"blocks","created_at":"2026-02-17T18:54:47.512872+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-6g0","title":"Resolve relative gitdir paths in _get_git_dir for submodule hooks","description":"_get_git_dir returns Path(actual_git_dir) verbatim when .git is a file. In submodules, .git commonly stores a relative gitdir like ../../.git/modules/deps/lib. Because the path is not resolved relative to repo_path, hook commands can see exists()==False and report a valid submodule as non-git.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.704885+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.365609+01:00","closed_at":"2026-02-16T06:08:21.36561+01:00"}
{"id":"te-6gy","title":"Improve te add input ergonomics for shell workflows","description":"`te add` requires `--text/-t` for the primary payload instead of accepting a positional argument or stdin/file input. This is less ergonomic for common CLI patterns like piping (`cat file | te add`) and quick one-liners (`te add \"note\"`).","acceptance_criteria":"- `te add` supports at least one ergonomic primary input path beyond required `--text` (positional argument, `--file`, or stdin mode).\n- Help text clearly documents the recommended input patterns and any precedence rules.\n- Current `--text` usage remains supported for backward compatibility.","status":"closed","priority":3,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:33:42.183179+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:37:47.537511+01:00","closed_at":"2026-02-16T18:37:47.537511+01:00","close_reason":"Closed","labels":["cli","ux"]}
{"id":"te-6h0","title":"Add onboarding troubleshooting docs for first-run model download and hook prerequisites","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:16.238443+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:36:45.867391+01:00","closed_at":"2026-02-16T00:36:45.867391+01:00","close_reason":"Closed"}
{"id":"te-6l7","title":"init ignores TOWN_ELDER_DATA_DIR unless --data-dir is explicitly passed","description":"## Summary\n`te init` derives `data_dir` from CLI context only, then falls back to `\u003cinit_path\u003e/.town_elder`.\nIt does not honor `TOWN_ELDER_DATA_DIR` resolution path.\n\n## Impact\nConfiguration behavior is inconsistent across commands:\n- runtime config supports env var\n- init command silently writes to default location instead\nThis can create split/hidden state and confusing setup outcomes.\n\n## Reproduction\n1. Set `TOWN_ELDER_DATA_DIR=/tmp/env_data`.\n2. Run `python -m town_elder init --path \u003crepo\u003e`.\n3. Observe `\u003crepo\u003e/.town_elder` is created while `/tmp/env_data` is not.\n\nI reproduced this behavior.\n\n## Expected\n`init` should honor resolved config data_dir from env var (or clearly reject env-specified path with explicit message).\n\n## Actual\n`init` always defaults to `\u003cpath\u003e/.town_elder` when `--data-dir` is omitted.\n\n## Code References\n- `src/town_elder/cli/__init__.py:520`\n- `src/town_elder/cli/__init__.py:521`\n- `src/town_elder/cli/__init__.py:522`","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:33:49.316671+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:54:39.069114+01:00"}
{"id":"te-6nt","title":"_is_te_hook false-positives on quoted strings and can delete non-TE hooks","description":"## Summary\n`_is_te_hook()` scans raw text with broad regexes and does not verify shell command position. A non-Town Elder hook that merely prints a matching string is classified as Town Elder.\n\n## Reproduction\n1. Create a repo with `.git/hooks/post-commit`:\n   ```sh\n   #!/bin/sh\n   echo \"te commit-index\"\n   other-tool --run\n   ```\n2. Run `te hook uninstall --repo \u003crepo\u003e` (without `--force`).\n\n## Actual\nThe hook is removed with exit code 0.\n\n## Expected\nThe hook should be treated as non-Town Elder and uninstall should refuse unless `--force` is provided.\n\n## Impact\nSafety check can be bypassed accidentally by benign strings, leading to unintended deletion of non-Town Elder hooks.\n\n## Evidence\n- Detection is regex-on-text without shell tokenization (`src/town_elder/cli/__init__.py:72`).\n- Uninstall trusts this boolean for destructive behavior (`src/town_elder/cli/__init__.py:1084`).\n- This is a broader false-positive class than comment-only matching (related to closed `te-c24`).\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T06:38:22.67026+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:07:47.6063+01:00","closed_at":"2026-02-16T07:07:47.606303+01:00"}
{"id":"te-6wr","title":"Reduce Ruff lint debt and enforce lint gate in CI","description":"Ruff currently reports complexity and maintainability findings in core CLI and parser paths. Lint debt should be reduced and CI should block regressions.","acceptance_criteria":"Ruff passes for src and tests under project policy; CI executes Ruff as required quality gate.","status":"closed","priority":2,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:25:15.29512+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820808+01:00","closed_at":"2026-02-15T11:01:51.649724+01:00","dependencies":[{"issue_id":"te-6wr","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:57.926528+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-74s","title":"Eliminate zvec teardown errors in test runs","description":"Pytest passes but emits RocksDB flush/close errors during fixture teardown.","acceptance_criteria":"1) Ensure stores/collections are closed before temp directories are removed. 2) Test fixtures handle lifecycle safely. 3) pytest output is free of teardown error logs for this path.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:35.470828+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822123+01:00","closed_at":"2026-02-14T22:12:05.329223+01:00"}
{"id":"te-78q","title":"te-domain-exceptions","description":"Define custom exception types: Town ElderError, DatabaseError, EmbeddingError, ConfigError","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:42.914373+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825788+01:00","closed_at":"2026-02-13T22:46:12.0943+01:00","dependencies":[{"issue_id":"te-78q","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:57:44.372351+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-7jt","title":"hook install ignores --repo for default data-dir resolution","description":"`te hook install --repo \u003cpath\u003e` resolves initialization from the current working directory instead of the target repo when `--data-dir` is omitted.\n\nRepro:\n1. Create a git repo at `/tmp/repo`.\n2. Initialize town elder in that repo:\n   `cd /tmp/repo \u0026\u0026 uv run --project /Users/bylin/Code/town_elder te init --path /tmp/repo`\n3. From a different directory that does not contain `.town_elder`, run:\n   `uv run --project /Users/bylin/Code/town_elder te hook install --repo /tmp/repo`\n\nActual:\n- Command exits with `Error: Database not initialized`.\n- It reports missing `.town_elder` in the current working directory, even though `/tmp/repo/.town_elder` exists.\n\nExpected:\n- `hook install --repo /tmp/repo` should resolve default storage relative to the target repo (or at minimum use repo-aware validation), not caller CWD.\n\nImpact:\n- Hook management fails from automation/orchestrators that run outside repo root.\n\nLikely cause:\n- `hook.install()` calls `get_config(data_dir=None)` (CWD-dependent) after parsing `--repo`.\n- File: `src/town_elder/cli/__init__.py:1008` and `src/town_elder/cli/__init__.py:1010`.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T05:06:16.776038+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:36:15.675491+01:00","closed_at":"2026-02-16T06:36:15.675491+01:00","close_reason":"Closed"}
{"id":"te-7kd","title":"Hook script generation does not shell-escape --data-dir paths","description":"## Summary\nHook scripts generated by both `te hook install` and `te init --install-hook` interpolate `data_dir` inside double quotes without shell escaping. If the data directory contains a literal quote character, the generated script becomes syntactically invalid.\n\n## Reproduction\n1. Create a git repo.\n2. Initialize Town Elder with a quoted path, e.g. `te --data-dir '/tmp/.town_elder\"bad' init --path \u003crepo\u003e`.\n3. Run `te --data-dir '/tmp/.town_elder\"bad' hook install --repo \u003crepo\u003e`.\n4. Run `sh -n \u003crepo\u003e/.git/hooks/post-commit`.\n\nObserved: shell syntax error (`unexpected EOF while looking for matching '\"'`).\nExpected: generated hook remains valid regardless of path characters.\n\n## Evidence\n- `src/town_elder/cli/__init__.py:1015` constructs `data_dir_arg` without escaping embedded quotes.\n- `src/town_elder/cli/__init__.py:474` and `src/town_elder/cli/__init__.py:475` do the same for `init --install-hook`.\n\n## Impact\nAutomatic commit indexing can be broken for valid filesystem paths, and unescaped interpolation creates shell-injection risk in generated hooks.\n","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T04:28:58.052198+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.187531+01:00","closed_at":"2026-02-16T06:08:21.187532+01:00"}
{"id":"te-7lt","title":"Implement true incremental commit indexing","description":"Current hook path reindexes recent history each commit; add durable state so only new commits are indexed.","acceptance_criteria":"1) commit-index defaults to indexing only commits after last indexed marker. 2) post-commit hook uses incremental path. 3) Re-running commit-index without new commits performs no duplicate writes. 4) Tests cover idempotency and state updates.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:32.141856+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819879+01:00","closed_at":"2026-02-14T19:32:12.366004+01:00"}
{"id":"te-7nz","title":"[Rust Shared Core] Port git blob and diff parsing primitives","description":"Port git text parsing primitives used by incremental indexing and commit diff interpretation.\n\nScope:\n- Implement Rust parsers for:\n  - `git ls-files --stage` output\n  - diff header path extraction (quoted/unquoted path variants)\n  - diff-to-file/hunk text structuring used before embedding\n- Expose through PyO3 and add parity tests.\n\nCode areas:\n- rust/crates/te-core/src/lib.rs\n- rust/src/lib.rs\n- src/town_elder/indexing/git_hash_scanner.py\n- src/town_elder/git/diff_parser.py\n- tests/test_git_hash_scanner.py\n- tests/test_core.py (DiffParser-related coverage)","design":"Keep subprocess invocation in Python for now; only move parse logic in this ticket.","acceptance_criteria":"- Rust parser handles all existing edge cases currently tested in Python.\n- Added tests prove quoted path and spaces behavior parity.\n- PyO3 bindings return data shapes consumable by Python adapter without extra conversion hacks.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:13.292095+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T21:42:11.24308+01:00","closed_at":"2026-02-17T21:42:11.24308+01:00","close_reason":"Closed","labels":["git","parity","rust"],"dependencies":[{"issue_id":"te-7nz","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:49:50.00909+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-7nz","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:50:00.285365+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-7r2","title":"Make hook execution integration test assert real side effects","description":"Current hook execution test monkeypatches in-process functions but hook execution occurs in a separate process, so the assertion does not verify real behavior. Replace with a true integration assertion based on durable side effects.","acceptance_criteria":"1) Test verifies actual hook-triggered indexing side effect (e.g. state file/document count), not monkeypatched call count. 2) Test fails if hook command is broken. 3) Remove misleading no-op verification comments.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:30.760168+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:41:10.289511+01:00","closed_at":"2026-02-15T15:41:10.289511+01:00","close_reason":"Closed"}
{"id":"te-84k","title":"Harden CLI integration test setup subprocess checks","description":"Many integration tests run git or CLI subprocesses during setup without check=True or explicit return-code assertions. Failures can be silently ignored and produce false positives or delayed confusing failures.","acceptance_criteria":"1) Setup subprocess calls are checked via check=True or explicit return-code assertions. 2) Setup failures surface immediately with useful diagnostics. 3) CI behavior remains stable.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.139916+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:56:53.579768+01:00","closed_at":"2026-02-15T16:30:00+01:00"}
{"id":"te-88t","title":"High-performance .rst integration and indexing optimization","description":"Enable high-performance initial indexing for large repositories (target: 60k+ files) with first-class `.rst` support and a parallelized parse/embed/store pipeline.\n\nScope:\n- Add robust `.rst` parsing and chunk metadata extraction.\n- Rework `te index` file indexing into a high-throughput pipeline.\n- Skip unchanged files via git blob hashes.\n- Batch embeddings and vector writes for throughput.\n- Provide stage-level progress output to expose bottlenecks.\n- Validate correctness and performance with automated tests and benchmark tooling.\n\nOut of scope:\n- Commit indexing behavior (`te index commits`) except shared utilities.\n- New embedding models or remote/vector SaaS integrations.","acceptance_criteria":"- `te index` supports `.rst` ingestion with section-aware chunking and directive metadata.\n- Initial indexing pipeline is parallelized and uses batched embedding + bulk vector writes.\n- Re-index runs skip unchanged files by comparing git blob hash state.\n- CLI exposes stage-level progress for scan/parse/embed/store.\n- Test suite covers parser behavior, incremental skip logic, and pipeline integration.\n- Benchmark artifacts/documentation exist for large-repo indexing.","status":"tombstone","priority":1,"issue_type":"epic","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.165595+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T21:14:19.148633+01:00","labels":["indexing","performance","rst"],"deleted_at":"2026-02-16T21:14:19.148633+01:00","deleted_by":"Kalle Bylin","delete_reason":"Remove parent organizer epic per request; keep only actionable child tasks","original_type":"epic"}
{"id":"te-88t.1","title":"Add canonical initial-indexing CLI entrypoint (te index --all)","description":"Define and implement the canonical initial-indexing entrypoint as `te index --all` while preserving existing subcommands.\n\nImplementation guidance:\n1. Update `src/town_elder/cli/__init__.py` so `index_app` supports `--all` at `te index` level (likely via callback with `invoke_without_command=True`).\n2. Route `te index --all` to the file-index pipeline for the target path (default `.`), and keep `te index files` and `te index commits` behavior unchanged.\n3. Ensure help text clearly distinguishes:\n   - `te index --all` (full repository file indexing)\n   - `te index files [PATH]` (scoped/manual file indexing)\n   - `te index commits` (git commit indexing)\n4. Add regression tests in `tests/test_cli_regressions.py` for command dispatch and help output.\n5. Update `README.md` command examples and command reference table.","acceptance_criteria":"- `uv run te index --all` executes file indexing successfully.\n- Existing `te index files` and `te index commits` commands still pass current tests.\n- CLI help output documents the new entrypoint without ambiguity.\n- README examples and command table include `te index --all`.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.272972+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T21:26:59.323872+01:00","closed_at":"2026-02-16T21:26:59.323872+01:00","close_reason":"Closed","labels":["cli","indexing"]}
{"id":"te-88t.2","title":"Implement .rst parser module with semantic chunking + directive metadata","description":"Implement a dedicated `.rst` parser module with section-aware chunking and directive metadata extraction.\n\nImplementation guidance:\n1. Add `docutils` to runtime dependencies in `pyproject.toml`.\n2. Create `src/town_elder/parsers/rst_handler.py` with a stable API for worker use (pure top-level functions for multiprocessing compatibility).\n3. Parse `.rst` with docutils and produce clean text while preserving hierarchical section context.\n4. Chunk semantically using reStructuredText heading underline patterns (e.g. `====`, `----`, etc.) so chunks align to sections.\n5. Extract directive metadata for:\n   - `.. note::`\n   - `.. warning::`\n   - `.. versionadded::`\n6. Add temporal metadata flags when content includes:\n   - `.. deprecated::`\n   - `.. versionchanged::`\n7. Include robust handling for malformed `.rst` (skip bad file with warning; do not crash full indexing).\n8. Add focused tests in `tests/` with fixtures asserting chunk boundaries, section paths, directive extraction, and temporal tags.","acceptance_criteria":"- `.rst` input produces section-aligned chunks with hierarchical metadata.\n- Directive bodies for note/warning/versionadded are captured in chunk metadata.\n- Chunks containing deprecated/versionchanged are tagged in metadata.\n- Malformed `.rst` does not terminate the indexing run.\n- New parser tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.379289+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T21:39:53.63088+01:00","closed_at":"2026-02-16T21:39:53.63088+01:00","close_reason":"Closed","labels":["indexing","parser","rst"]}
{"id":"te-88t.3","title":"Refactor file scanner for .rst support and _build exclusion","description":"Refactor file discovery for indexing to support `.rst` at scale and enforce default Sphinx build exclusions.\n\nImplementation guidance:\n1. Extract file discovery from `src/town_elder/cli/__init__.py:index_files` into a dedicated scanner module (e.g. `src/town_elder/indexing/file_scanner.py`).\n2. Default indexed extensions should include `.py`, `.md`, and `.rst`.\n3. Add `_build` to default exclusion patterns (for Sphinx-generated content) while preserving existing excludes (`.git`, `.venv`, etc.).\n4. Keep `--exclude` behavior additive and consistent with current matching semantics.\n5. Ensure scanner returns normalized, deterministic file lists (stable ordering) to improve reproducibility and testability.\n6. Add tests for:\n   - `.rst` inclusion\n   - `_build/` exclusion\n   - user-provided excludes\n   - non-directory and missing-path validation remains unchanged","acceptance_criteria":"- Index scanner includes `.rst` files by default.\n- `_build/` trees are excluded by default.\n- Existing exclusion behavior remains backward compatible.\n- Scanner tests cover extension inclusion/exclusion and deterministic ordering.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.486972+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T21:49:51.391136+01:00","closed_at":"2026-02-16T21:49:51.391136+01:00","close_reason":"Closed","labels":["indexing","rst","scanner"],"dependencies":[{"issue_id":"te-88t.3","depends_on_id":"te-88t.1","type":"blocks","created_at":"2026-02-16T21:11:27.48889+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-88t.4","title":"Add git blob-hash change detection to skip unchanged files","description":"Implement git-blob-hash shortcutting so unchanged files are skipped before parse/embed work.\n\nImplementation guidance:\n1. Add a git-index scanner path using `git ls-files --stage` to retrieve tracked file paths + blob SHA-1.\n2. Persist per-repo file hash state in Town Elder data dir (new state file or namespaced section in existing state), keyed by repo + relative path.\n3. During indexing, only schedule files when:\n   - file hash is missing in state, or\n   - blob hash changed since last successful index.\n4. Handle deletions/renames cleanly:\n   - stale state entries removed or marked tombstoned,\n   - vector docs for deleted files are cleaned up or excluded from future queries.\n5. Record blob hash in vector metadata for observability/debugging.\n6. Add tests for first run, no-op rerun, single-file change, and deletion behavior.","acceptance_criteria":"- `git ls-files --stage` is used to drive tracked-file hash comparisons.\n- Second index run with no file changes performs near-zero parse/embed operations.\n- Changed files are re-indexed; unchanged files are skipped.\n- Deleted files are removed from state and do not remain queryable as active docs.\n- Incremental hash-state tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.596079+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T22:22:24.556398+01:00","closed_at":"2026-02-16T22:22:24.556398+01:00","close_reason":"Closed","labels":["git","indexing","performance"],"dependencies":[{"issue_id":"te-88t.4","depends_on_id":"te-88t.3","type":"blocks","created_at":"2026-02-16T21:11:27.597964+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-88t.5","title":"Refactor index files into producer/worker generator pipeline","description":"Refactor file indexing into a generator-based, parallel parse pipeline with explicit producer/worker stages.\n\nImplementation guidance:\n1. Introduce an indexing pipeline module (e.g. `src/town_elder/indexing/pipeline.py`) that composes generator stages.\n2. Producer stage:\n   - scans candidate files and emits work items (path, type, hash, metadata),\n   - runs in a dedicated thread to overlap I/O with downstream work.\n3. Parser stage:\n   - uses `concurrent.futures.ProcessPoolExecutor` for CPU-bound parse/chunk work,\n   - supports both `.py` (existing extraction path) and `.rst` (new handler module),\n   - keeps worker functions importable top-level callables.\n4. Ensure backpressure-safe handoff between producer and parser (bounded queue or chunked submit pattern).\n5. Guarantee deterministic shutdown and error propagation (clean cancellation, no orphan workers).\n6. Wire pipeline into `index files`/`index --all` path in `src/town_elder/cli/__init__.py`.","acceptance_criteria":"- Indexing pipeline uses producer + ProcessPoolExecutor parser workers.\n- .py, .md, and .rst parsing all execute through the parser worker stage.\n- Pipeline handles worker errors without deadlock or partial shutdown.\n- Existing index command behavior remains stable except intentional performance changes.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.705049+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T22:54:56.857474+01:00","closed_at":"2026-02-16T22:54:20.72603+01:00","close_reason":"Closed","labels":["indexing","parallelism","performance"],"dependencies":[{"issue_id":"te-88t.5","depends_on_id":"te-88t.2","type":"blocks","created_at":"2026-02-16T21:11:27.706796+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.5","depends_on_id":"te-88t.4","type":"blocks","created_at":"2026-02-16T21:11:27.707366+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-88t.6","title":"Implement BatchManager with FastEmbed batching + zvec bulk inserts","description":"Implement batch embedding + bulk vector writes to maximize FastEmbed and zvec throughput.\n\nImplementation guidance:\n1. Add a `BatchManager` (e.g. `src/town_elder/indexing/batch_manager.py`) to accumulate parsed chunks and flush in fixed-size batches.\n2. Default batch size: 256 chunk texts per embed call.\n3. Extend `src/town_elder/embeddings/embedder.py` so batch embedding can pass FastEmbed tuning parameters (`batch_size=256`, `parallel=os.cpu_count()` by default).\n4. Add `bulk_upsert`/`bulk_insert` API to `src/town_elder/storage/vector_store.py` to write a batch in one operation (or minimal-call fallback if zvec API constraints require).\n5. Flush remaining partial batch at pipeline end.\n6. Ensure batch failures isolate/diagnose failed documents without dropping whole run state silently.\n7. Add unit tests validating:\n   - correct batch sizing and final flush,\n   - one embed call per batch,\n   - one bulk store call per batch.","acceptance_criteria":"- Embedding is performed in batches of 256 by default.\n- FastEmbed receives explicit parallelism configuration based on host CPU count.\n- Vector store supports batch writes and is used by the indexing pipeline.\n- Partial final batches are flushed correctly.\n- Batch manager tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.813753+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T23:16:19.053303+01:00","closed_at":"2026-02-16T23:16:19.053303+01:00","close_reason":"Closed","labels":["embedding","performance","zvec"],"dependencies":[{"issue_id":"te-88t.6","depends_on_id":"te-88t.5","type":"blocks","created_at":"2026-02-16T21:11:27.815628+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-88t.7","title":"Add rich.progress stage telemetry for indexing bottlenecks","description":"Add stage-specific progress visibility for scanning, parsing, embedding, and storing so users can identify bottlenecks during large index runs.\n\nImplementation guidance:\n1. Use `rich.progress` in index CLI flow to expose at least these counters:\n   - Scanning\n   - Parsing\n   - Embedding\n   - Storing\n2. Show progress messages similar to:\n   - `Parsing: 450/1000`\n   - `Embedding: 200/1000`\n3. If total work is unknown initially, use indeterminate mode then set totals when scan completes.\n4. Ensure progress rendering degrades gracefully in non-interactive environments.\n5. Keep final summary line with indexed/skipped/excluded counts.\n6. Add CLI tests (where feasible) for key status text and successful completion output.","acceptance_criteria":"- Index command displays stage-level progress for parse/embed/store.\n- Progress output works for large runs without flooding stderr/stdout.\n- Non-TTY execution still emits readable status and final summary.\n- UX-focused CLI tests pass.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:27.921288+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T23:28:42.314099+01:00","closed_at":"2026-02-16T23:28:42.314099+01:00","close_reason":"Closed","labels":["cli","indexing","ux"],"dependencies":[{"issue_id":"te-88t.7","depends_on_id":"te-88t.6","type":"blocks","created_at":"2026-02-16T21:11:27.923216+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-88t.8","title":"Add integration tests, benchmark harness, and docs for 60k-file indexing","description":"Add end-to-end validation and benchmark artifacts proving correctness + speed for large-repo indexing.\n\nImplementation guidance:\n1. Add integration tests covering:\n   - `.rst` section chunking and directive metadata extraction,\n   - deprecated/versionchanged temporal tagging,\n   - unchanged-file skip behavior via hash state.\n2. Add a benchmark script/fixture generator (e.g. under `scripts/` or `tests/perf/`) for large file sets (target scale: 60k+ files mix of `.py`, `.md`, `.rst`).\n3. Capture and document baseline vs optimized results (scan throughput, parse throughput, embed throughput, total wall time).\n4. Update README performance notes and indexing docs with:\n   - new `.rst` capability,\n   - `te index --all` usage,\n   - expected first-run vs rerun behavior.\n5. Ensure CI-targeted tests remain deterministic and skip heavyweight benchmark by default unless explicitly requested.","acceptance_criteria":"- Integration tests verify `.rst` parsing metadata and hash-based incremental skipping.\n- Benchmark tooling exists and can be run locally to reproduce throughput measurements.\n- Performance documentation includes before/after numbers and methodology.\n- README is updated for `.rst` support and full-index command usage.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T21:11:28.029675+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T06:47:09.890443+01:00","closed_at":"2026-02-17T06:47:09.890443+01:00","close_reason":"Closed","labels":["docs","performance","testing"],"dependencies":[{"issue_id":"te-88t.8","depends_on_id":"te-88t.1","type":"blocks","created_at":"2026-02-16T21:11:28.031956+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.2","type":"blocks","created_at":"2026-02-16T21:11:28.032618+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.3","type":"blocks","created_at":"2026-02-16T21:11:28.033208+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.4","type":"blocks","created_at":"2026-02-16T21:11:28.033781+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.5","type":"blocks","created_at":"2026-02-16T21:11:28.03432+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.6","type":"blocks","created_at":"2026-02-16T21:11:28.034871+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-88t.8","depends_on_id":"te-88t.7","type":"blocks","created_at":"2026-02-16T21:11:28.035407+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-8dz","title":"[Rust Shared Core] Port RST chunk and metadata extraction","description":"Port RST chunking + metadata extraction logic into Rust while preserving current chunk semantics.\n\nScope:\n- Implement heading boundary detection, section path derivation, directive extraction, temporal tags.\n- Preserve fallback behavior for malformed/empty content.\n- Expose chunk metadata through PyO3.\n\nCode areas:\n- rust/crates/te-core/src/lib.rs (rst module)\n- rust/src/lib.rs\n- src/town_elder/parsers/rst_handler.py\n- src/town_elder/indexing/pipeline.py\n- tests/test_rst_handler.py\n- tests/test_indexing_pipeline.py","design":"Keep regex-compat behavior where required; document intentional deviations if discovered.","acceptance_criteria":"- Rust RST parser reproduces existing section/directive/temporal-tag outputs on contract fixtures.\n- Chunk index and section depth semantics remain compatible with existing metadata consumers.\n- Python tests include Rust parity assertions for representative RST samples.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:33.865784+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T23:12:33.316044+01:00","closed_at":"2026-02-17T23:12:33.316044+01:00","close_reason":"Closed","labels":["parity","rst","rust"],"dependencies":[{"issue_id":"te-8dz","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:50:30.998505+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-8dz","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:50:41.174413+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-8na","title":"Correct CLI stdout vs stderr stream usage","description":"Normal command output should go to stdout; error output should go to stderr.","acceptance_criteria":"1) Success paths write human-readable output to stdout. 2) Error paths write to stderr and set proper exit codes. 3) Stream behavior is covered by CLI tests.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:44.079818+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822783+01:00","closed_at":"2026-02-14T22:19:35.297639+01:00"}
{"id":"te-8s2","title":"get_config ignores TOWN_ELDER_DATA_DIR when data_dir is omitted","description":"## Summary\n`TOWN_ELDER_DATA_DIR` is ignored when calling `get_config()` without an explicit `data_dir` argument.\n\n## Reproduction\nRun:\n```bash\nUV_CACHE_DIR=.uv-cache uv run python - \u003c\u003c'PY'\nimport os, tempfile\nfrom pathlib import Path\nfrom town_elder.config import get_config\n\nbase = Path(tempfile.mkdtemp(prefix='te-env-test-'))\nos.chdir(base)\ndata_dir = base / 'custom_data'\ndata_dir.mkdir()\nos.environ['TOWN_ELDER_DATA_DIR'] = str(data_dir)\n\nprint(get_config(clear_cache=True).data_dir)\nPY\n```\n\n## Expected\n`get_config()` should resolve to `TOWN_ELDER_DATA_DIR` when set.\n\n## Actual\nRaises `ConfigError` complaining that `.town_elder` is missing in cwd.\n\n## Suspected Cause\nWhen `data_dir is None`, `get_config` always constructs `TownElderConfig(data_dir=_get_default_data_dir(...))`, which overrides `data_dir` from environment variables (`src/town_elder/config.py:89`).\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T07:14:22.459285+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:36:24.168298+01:00","closed_at":"2026-02-16T07:36:24.168298+01:00","close_reason":"Closed"}
{"id":"te-8td","title":"README: remove or implement nonexistent --no-uv hook option","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:52.739401+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.066487+01:00","closed_at":"2026-02-16T06:08:21.066488+01:00"}
{"id":"te-9aq","title":"Tighten init --force safe-path checks to prevent deleting arbitrary hidden directories","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:32.417767+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.812608+01:00","closed_at":"2026-02-16T02:02:16.812608+01:00","close_reason":"Closed"}
{"id":"te-9er","title":"te-vector-store-wrapper","description":"Implement zvec wrapper with insert, search, and delete operations for vector storage","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:36.839185+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.82941+01:00","closed_at":"2026-02-13T22:46:12.068827+01:00","dependencies":[{"issue_id":"te-9er","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:51.841469+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-9ex","title":"[Rust Native CLI] Add backend abstraction and zvec-binding feasibility spike","description":"Design and implement Rust backend abstraction for embeddings/vector storage, including zvec readiness spike.\n\nScope:\n- Introduce traits/interfaces in Rust for embed + vector-store operations used by CLI.\n- Implement at least one usable backend path for local testing.\n- Add explicit zvec Rust binding feasibility note + gap list (blocking items for full native parity).\n\nCode areas:\n- rust/crates/te-core/src/lib.rs (traits)\n- rust/src/main.rs / runtime integration\n- docs/rust-backend-feasibility.md (new)\n- context/research/zvec-embedding-db.md (update with concrete findings)","design":"This ticket is the guardrail against overcommitting to unavailable Rust storage APIs.","acceptance_criteria":"- Backend traits compile and are exercised by tests.\n- Feasibility doc lists what works now vs what blocks full native storage parity.\n- Decision record identifies interim backend strategy if zvec Rust bindings are incomplete.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:27.849215+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T23:59:23.767336+01:00","closed_at":"2026-02-17T23:59:23.767336+01:00","close_reason":"Closed","labels":["backend","rust","spike"],"dependencies":[{"issue_id":"te-9ex","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:52:44.164277+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-9h0","title":"te-cli-init-command","description":"Implement 'te init' command to initialize database storage in specified directory","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:40.505593+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829155+01:00","closed_at":"2026-02-14T13:58:04.258201+01:00","close_reason":"init command already implemented and working","dependencies":[{"issue_id":"te-9h0","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:53:56.196227+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-9h0","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.213053+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-9h1","title":"Align CLI and storage invariants with canonical context","description":"Reconcile command names and storage path invariants with canonical architecture/context while keeping README onboarding coherent.","acceptance_criteria":"1) Decide and document canonical invariants for command surface (query/status vs aliases) and storage location (.git/te vs .te). 2) Implement chosen behavior or compatibility aliases. 3) Update README and canonical docs consistently.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:04.634379+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818999+01:00","closed_at":"2026-02-14T19:08:09.670004+01:00","close_reason":"Closed"}
{"id":"te-9kq","title":"Fix init path and data directory consistency","description":"Commands should operate predictably when te is initialized outside current working directory.","acceptance_criteria":"1) After te init --path X, users can run follow-up commands against X without changing directory (via persisted config or explicit flags). 2) add/search/index/stats share consistent path semantics. 3) Docs reflect the chosen behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:42.421172+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819648+01:00","closed_at":"2026-02-14T21:38:51.83142+01:00"}
{"id":"te-9oe","title":"Report accurate indexing success and skip counts","description":"Index commands currently report attempted totals as successful totals.","acceptance_criteria":"1) index and commit-index output attempted/succeeded/skipped counts. 2) Final success count equals inserted documents. 3) Tests verify behavior with unreadable files and skipped commits.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:02.973554+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823404+01:00","closed_at":"2026-02-14T19:33:31.336298+01:00"}
{"id":"te-9s6","title":"commit-index --all is ignored when incremental state exists","description":"## Summary\nWhen `te commit-index --all` is run in a repo that already has `index_state.json`, the command does not traverse full history. It stops at the incremental sentinel and indexes nothing older than the current cursor.\n\n## Reproduction\n1. Create a git repo with 10 commits.\n2. Run `te init`.\n3. Run `te commit-index --limit 3` (indexes only newest 3, writes state cursor).\n4. Run `te commit-index --all`.\n5. Count indexed docs via `te export --output - --format json`.\n\nObserved: count stays at 3.\nExpected: count should grow to include full commit history (10 in this repro), or `--all` should explicitly disable incremental cursor behavior.\n\n## Evidence\nIn `src/town_elder/cli/__init__.py`, the incremental branch (`if incremental and last_indexed and not force`) runs before the `elif all_history` branch, so `--all` is effectively bypassed when a sentinel exists.\n\n## Impact\nUsers cannot backfill older history after initial limited indexing unless they discover and use a non-obvious flag combination (`--full`/`--force`), which contradicts `--all` semantics.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:19.530024+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:07:47.66687+01:00","closed_at":"2026-02-16T07:07:47.666871+01:00"}
{"id":"te-9yz","title":"Standardize path/repo argument naming across te commands","description":"Commands that act on a filesystem or repository use different interfaces for the same concept: `te init --path`, `te index [PATH]`, `te commit-index --repo`, and `te hook \u003csubcommand\u003e --repo`. This inconsistency increases cognitive load and makes command usage less predictable.","acceptance_criteria":"- Define a consistent convention for target location arguments (for example, positional path where practical, or a shared `--path`/`--repo` approach).\n- Apply the convention consistently across `init`, `index`, `commit-index`, and `hook` subcommands.\n- Keep backward compatibility (deprecated aliases/options) with clear migration notes in help output.","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:32:53.9001+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:04:48.824922+01:00","labels":["cli","ux"]}
{"id":"te-a00","title":"hook install writes relative --data-dir values that break at hook runtime","description":"`te hook install` writes relative `--data-dir` values directly into the hook script. If install is run from a different CWD than the repo root, the hook later resolves to a different directory and fails.\n\nRepro:\n1. Create repo at `/tmp/repo`.\n2. From `/Users/bylin/Code/town_elder`, run:\n   `uv run --project /Users/bylin/Code/town_elder te --data-dir .te_rel_db init --path /tmp/repo`\n3. Install hook with same relative data-dir from the same CWD:\n   `uv run --project /Users/bylin/Code/town_elder te --data-dir .te_rel_db hook install --repo /tmp/repo`\n4. Inspect generated hook: it contains `--data-dir .te_rel_db` (relative path).\n5. Simulate hook execution from repo root:\n   `cd /tmp/repo \u0026\u0026 uv run --project /Users/bylin/Code/town_elder te --data-dir .te_rel_db commit-index --repo /tmp/repo`\n\nActual:\n- `commit-index` fails with `Error: Database not initialized`.\n- DB was initialized at `/Users/bylin/Code/town_elder/.te_rel_db`, but hook resolves to `/tmp/repo/.te_rel_db`.\n\nExpected:\n- Hook should embed an absolute `data_dir` path so runtime CWD does not change behavior.\n\nImpact:\n- Auto-index hooks silently break for users who initialize/install from outside repo root with relative `--data-dir`.\n\nLikely cause:\n- Code comment says absolute path should be used, but implementation uses `str(config.data_dir)` without normalization.\n- File: `src/town_elder/cli/__init__.py:1016` and `src/town_elder/cli/__init__.py:1021`.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T05:06:57.004673+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.30666+01:00","closed_at":"2026-02-16T06:08:21.306661+01:00","close_reason":"Closed"}
{"id":"te-a31","title":"te-cli-entry-point","description":"Create main CLI entry point with typer and command registration","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:57.249237+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824048+01:00","closed_at":"2026-02-14T13:57:23.123382+01:00","close_reason":"CLI entry point implemented with typer: init, add, search, stats, index, commit-index, hook commands all working","dependencies":[{"issue_id":"te-a31","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:57:30.212185+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-aaq","title":"Add Ruff linting to te project","description":"Add Ruff as a dev dependency, configure lint rules in pyproject.toml, add a lint command to contributor docs, and include Ruff in CI quality gates.","acceptance_criteria":"1)  runs successfully in dev setup. 2) pyproject includes Ruff configuration with at least baseline rule set and excludes. 3) README/AGENTS docs mention lint command. 4) CI runs Ruff and fails on lint violations.","notes":"Duplicate of te-rtr which already added Ruff linting","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:43:57.197944+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823831+01:00","closed_at":"2026-02-14T22:57:28.257755+01:00"}
{"id":"te-ab8","title":"CLI command naming audit: review command names, flags for usability","status":"in_progress","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:27:27.863821+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:08:03.46009+01:00"}
{"id":"te-adl","title":"JSON parsing error in ZvecStore crashes search/get operations","description":"ZvecStore.metadata() and ZvecStore.get() call json.loads() on stored metadata without try-except. If metadata is corrupted or not valid JSON, this raises JSONDecodeError and crashes the operation.","acceptance_criteria":"All json.loads() calls in vector_store.py wrapped in try-except with fallback to empty dict; tests verify corrupted metadata returns empty dict instead of crashing.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T10:30:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T08:54:13.413573+01:00","closed_at":"2026-02-16T08:54:13.413573+01:00","close_reason":"Closed"}
{"id":"te-adm","title":"Date parsing error in GitRunner crashes commit indexing","description":"datetime.fromisoformat() in git/runner.py lines 93 and 185 can raise ValueError if git output has unexpected date format. This crashes the entire commit indexing process.","acceptance_criteria":"Date parsing wrapped in try-except with error handling; invalid dates logged and skipped rather than crashing; tests verify edge case handling.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T10:31:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T08:54:13.472536+01:00","closed_at":"2026-02-16T08:54:13.472536+01:00","close_reason":"Closed"}
{"id":"te-adn","title":"Embedder dimension hardcoded to 384 regardless of config","description":"embeddings/embedder.py returns hardcoded 384 from dimension property, ignoring embed_dimension from config. If user sets different dimension, runtime dimension mismatches occur.","acceptance_criteria":"Dimension property reads from config or actual model; dimension validated at startup to match config vs model; tests verify config changes are reflected.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T10:32:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T09:12:23.109442+01:00","closed_at":"2026-02-16T09:12:23.109442+01:00","close_reason":"Closed"}
{"id":"te-ado","title":"Race condition in ZvecStore collection access","description":"ZvecStore._get_collection() checks if _collection is None without thread synchronization. Concurrent access from multiple threads can lead to race condition where both try to create/open collection.","acceptance_criteria":"Add thread locking (threading.Lock) around _collection access; tests verify concurrent access is safe; document thread-safety guarantees.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T10:33:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T09:11:51.921291+01:00","closed_at":"2026-02-16T09:11:51.921291+01:00","close_reason":"Closed"}
{"id":"te-adp","title":"Invalid data-dir path not validated at CLI entry","description":"CLI accepts --data-dir with non-existent or invalid paths without validation at entry point. Error only surfaces later with confusing message.","acceptance_criteria":"Early validation of data-dir path existence and directory type; clear error message if invalid; tests verify validation happens before service initialization.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T10:34:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T09:23:44.34511+01:00","closed_at":"2026-02-16T09:23:44.345113+01:00"}
{"id":"te-awt","title":"Guard commit-index batch embedding alignment (zip strict) to prevent silent commit drops","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:42.376745+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:56:38.917968+01:00","closed_at":"2026-02-16T02:56:38.917968+01:00","close_reason":"Closed"}
{"id":"te-ax2","title":"commit-index --full fails to advance index state after duplicate commit skips","description":"commit_index uses store.insert for commit docs and sets frontier_blocked=True on first insert failure. In --full mode against an already indexed store, older duplicate commits fail first; newer commits may still insert, but frontier_commit_hash no longer advances, so index_state.json is never updated and later incremental runs reprocess the same commits.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.708972+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:07:47.785902+01:00","closed_at":"2026-02-16T07:07:47.785903+01:00"}
{"id":"te-ayj","title":"te-setup-uv-and-pyenv","description":"Set up uv and pyenv in this project so we can easily run everything with uv. This will allow us to easily manage dependencies and virtual environments.","status":"closed","priority":0,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T09:07:34.533483+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814397+01:00","closed_at":"2026-02-14T13:57:19.314696+01:00","close_reason":"Project setup completed: pyproject.toml, dependencies, .python-version all configured"}
{"id":"te-b0j","title":"Fix IndexService index_file doc_id to satisfy zvec ID regex","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:28.624822+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:18:19.386471+01:00","closed_at":"2026-02-16T07:45:00+01:00"}
{"id":"te-b19","title":"Add CLI integration tests for critical behaviors","description":"Current tests miss key CLI workflows and safety behaviors discovered in review.","acceptance_criteria":"1) Add integration tests for path semantics, hook uninstall safety, incremental indexing, metadata validation, stream routing, and exit codes. 2) Tests run in temp git repos and assert observable CLI behavior.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:14.926596+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818781+01:00","closed_at":"2026-02-14T21:55:50.041339+01:00"}
{"id":"te-blu","title":"Optimize te index file discovery to avoid full-list materialization on large repos","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:47.088656+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:36:15.677182+01:00","closed_at":"2026-02-16T06:36:15.677182+01:00","close_reason":"Closed"}
{"id":"te-c0n","title":"max_diff_size byte limit is not enforced for UTF-8 diffs","description":"## Summary\n`GitRunner.get_diff()` and `GitRunner.get_diffs_batch()` compare encoded byte length to `max_size`, but truncate by character count (`diff[:max_size]`). For multibyte UTF-8 content, resulting output can exceed the configured byte limit.\n\n## Reproduction\n1. Create a commit whose diff contains many multibyte characters (e.g. repeated `Ã©`).\n2. Call `get_diff(commit_hash, max_size=100)`.\n3. Measure `len(result.encode())`.\n\nObserved in repro: encoded length `142` with `max_size=100`.\n\nThe same behavior occurs in `get_diffs_batch()`.\n\n## Actual\nReturned diff can exceed the byte cap despite the truncation marker.\n\n## Expected\nReturned diff payload should honor `max_size` in bytes for all encodings.\n\n## Impact\nDiff size guard is unreliable for non-ASCII patches, increasing memory/serialization load and violating caller expectations.\n\n## Evidence\n- `get_diff()` byte check + char slicing mismatch: `src/town_elder/git/runner.py:232`.\n- `get_diffs_batch()` has the same mismatch in both truncation paths: `src/town_elder/git/runner.py:279` and `src/town_elder/git/runner.py:292`.\n","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T06:38:43.233087+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:07:47.726449+01:00","closed_at":"2026-02-16T07:07:47.72645+01:00"}
{"id":"te-c24","title":"_is_te_hook matches comment text and can delete non-TE hooks without --force","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:17.343852+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:20.82797+01:00","closed_at":"2026-02-16T06:08:20.827971+01:00"}
{"id":"te-c9n","title":"Honor configured embed_model in IndexService and QueryService default embedder construction","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:36.627429+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:40:44.512856+01:00","closed_at":"2026-02-16T02:00:00+01:00"}
{"id":"te-cbh","title":"Add CLI regression tests for top-k validation and non-text hook files","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:29.892624+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:12:48.784882+01:00","closed_at":"2026-02-16T00:12:48.784882+01:00","close_reason":"Closed"}
{"id":"te-chc","title":"te-cli-export-command","description":"Implement 'te export' command to export indexed data","notes":"Implemented 'te export' command to export indexed data to JSON or JSONL format. Added get_all method to ZvecStore and export command to CLI with options for output file, format (json/jsonl), and include-vectors flag.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:09.486592+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826509+01:00","closed_at":"2026-02-14T23:04:46.947915+01:00","dependencies":[{"issue_id":"te-chc","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:17.547702+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-chc","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.626135+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-cib","title":"Return real similarity scores from vector search","description":"Search currently returns hardcoded score 1.0 for all results.","acceptance_criteria":"1) Store returns actual similarity or distance-derived score from backend. 2) CLI shows meaningful ranked scores. 3) Tests validate non-constant score behavior.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:23.511601+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823002+01:00","closed_at":"2026-02-14T22:14:01.338528+01:00"}
{"id":"te-cif","title":"hook commands target wrong hooks directory in git worktrees","description":"## Summary\n`te hook install`, `te hook status`, and `te hook uninstall` resolve `.git` to the worktree-specific gitdir (`.../.git/worktrees/\u003cname\u003e`) and then read/write hooks there. Git executes hooks from the shared common gitdir (`.../.git/hooks`), so Town Elder installs hooks to a location Git never executes.\n\n## Reproduction\n1. Create a repo and commit once.\n2. Create a worktree (`git worktree add \u003cpath\u003e`).\n3. Run `te hook install --repo \u003cworktree-path\u003e`.\n4. Compare hook locations:\n   - Installed path from command output points to `.../.git/worktrees/\u003cname\u003e/hooks/post-commit`.\n   - `git -C \u003cworktree-path\u003e rev-parse --git-common-dir` points to `.../.git`.\n   - `.../.git/hooks/post-commit` is unchanged.\n\n## Actual\nHook file is created under the worktree private gitdir and is not the hook Git uses for commit hooks.\n\n## Expected\nHook commands should target the common hooks directory for the repository (`git rev-parse --git-common-dir`), including for worktrees.\n\n## Impact\nAutomatic commit indexing silently does not run for worktree commits after \"successful\" hook installation.\n\n## Evidence\n- `_get_git_dir()` returns the pointer target from `.git` files directly (`src/town_elder/cli/__init__.py:49`).\n- Hook commands derive `hooks/post-commit` from that value (`src/town_elder/cli/__init__.py:995`, `src/town_elder/cli/__init__.py:1072`, `src/town_elder/cli/__init__.py:1106`).\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T06:38:02.598194+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:56:36.4981+01:00","closed_at":"2026-02-16T06:56:36.4981+01:00","close_reason":"Closed"}
{"id":"te-cmo","title":"IndexService and QueryService ignore configured embed_dimension","description":"## Summary\n`IndexService` and `QueryService` construct defaults using:\n- `ZvecStore(config.data_dir / \\\"vectors\\\")` (no dimension argument)\n- `Embedder(model_name=config.embed_model)` (no embed_dimension argument)\n\nThis bypasses configured `embed_dimension` and defaults store dimension to 384.\n\n## Impact\nIf configuration uses non-default embedding dimensions/models, service defaults are inconsistent and can produce schema mismatch or search/index failures.\n\n## Reproduction\nPatch `get_config()` to return `embed_dimension=768`, instantiate service with only one dependency injected:\n- `IndexService(embedder=fake_embedder)` creates `store.dimension == 384`.\n- `QueryService(embedder=fake_embedder)` creates `store.dimension == 384`.\n\nI reproduced both.\n\n## Expected\nBoth services should pass `embed_dimension` to `ZvecStore(...)` and `Embedder(...)` when constructing defaults.\n\n## Actual\nDimension config is ignored by default constructors.\n\n## Code References\n- `src/town_elder/services/index_service.py:23`\n- `src/town_elder/services/index_service.py:24`\n- `src/town_elder/services/query_service.py:18`\n- `src/town_elder/services/query_service.py:19`","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:34:09.352082+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:53:10.712321+01:00","closed_at":"2026-02-16T17:53:10.712321+01:00","close_reason":"Closed"}
{"id":"te-cv5","title":"commit-index crashes on valid JSON state files that are not objects","description":"## Summary\n`_load_index_state()` and `_save_index_state()` assume `json.loads()` returns a mapping and index into `state[\\\"repos\\\"]` without validating `state` type.\nA state file like `[\\\"repos\\\"]` (valid JSON, wrong shape) triggers `TypeError` and surfaces a traceback in `te commit-index`.\n\n## Impact\nA malformed but valid JSON state file can hard-crash `commit-index`, breaking incremental indexing until manual cleanup.\n\n## Reproduction\n1. Create `index_state.json` containing:\n   `[\"repos\"]`\n2. Run:\n   `python -m town_elder --data-dir \u003cdata_dir\u003e commit-index --repo \u003crepo\u003e`\n3. Observe traceback:\n   `TypeError: list indices must be integers or slices, not str`\n\nI reproduced this and confirmed traceback points to `_load_index_state`.\n\n## Expected\nMalformed/unknown JSON shapes should be treated as empty state (`{\"repos\": {}}`) without traceback.\n\n## Actual\nTypeError escapes from state parsing path.\n\n## Code References\n- `src/town_elder/cli/__init__.py:273`\n- `src/town_elder/cli/__init__.py:301`\n- `src/town_elder/cli/__init__.py:319`\n- `src/town_elder/cli/__init__.py:329`","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:32:25.635525+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:53:10.746512+01:00","closed_at":"2026-02-16T17:53:10.746512+01:00","close_reason":"Closed"}
{"id":"te-cye","title":"Do not silently recreate zvec collection on open failures","description":"ZvecStore catches all open errors and falls back to creating a new collection, masking corruption/schema/permission issues and risking silent data fork/loss.","acceptance_criteria":"Differentiate missing collection vs fatal open errors; fail fast on corruption/schema mismatch with actionable message; add tests proving no implicit create on non-not-found failures.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:13.577309+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813667+01:00","closed_at":"2026-02-14T23:33:32.62211+01:00","close_reason":"Closed"}
{"id":"te-czr","title":"Update README options/docs to match CLI reality (index path arg, no config.json artifact)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:38.748022+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.810093+01:00","closed_at":"2026-02-16T02:02:16.810093+01:00","close_reason":"Closed"}
{"id":"te-d0q","title":"[Rust Shared Core] Port commit-log and diff-text preparation primitives","description":"Port commit-log and batch diff text preparation primitives into Rust for commit indexing path.\n\nScope:\n- Parse git log + numstat formatted text into structured commit records.\n- Implement diff truncation helper behavior compatibility.\n- Implement commit text assembly used before embedding.\n\nCode areas:\n- rust/crates/te-core/src/lib.rs\n- rust/src/lib.rs\n- src/town_elder/git/runner.py\n- src/town_elder/cli/__init__.py (_run_commit_index path)\n- tests/test_git_runner.py\n- tests/test_cli_regressions.py (commit indexing behavior)","design":"Do not move git subprocess execution yet; only parse/transform outputs in this ticket.","acceptance_criteria":"- Rust parsers handle delimiter collisions and unicode subjects already covered by tests.\n- Commit text assembly output is stable and documented.\n- No state-frontier regression in incremental commit indexing logic.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:44.248622+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T23:21:37.249607+01:00","closed_at":"2026-02-17T23:21:37.249607+01:00","close_reason":"Closed","labels":["git","indexing","rust"],"dependencies":[{"issue_id":"te-d0q","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:50:51.352267+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-d0q","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:51:01.525721+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-d4w","title":"Write index_state.json atomically to avoid state corruption on interrupted writes","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:46.56733+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:07:47.845277+01:00","closed_at":"2026-02-16T07:07:47.845279+01:00"}
{"id":"te-ddj","title":"Validate metadata type for te add","description":"te add accepts JSON that is not an object and fails later with internal error.","acceptance_criteria":"1) Non-object JSON metadata is rejected as invalid argument with clear message. 2) Exit code matches invalid usage. 3) Tests cover list/string metadata rejection.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:54.355685+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822552+01:00","closed_at":"2026-02-14T22:21:14.779588+01:00"}
{"id":"te-df9","title":"te-domain-entities","description":"Define domain entities: Document, Chunk, Commit, SearchResult","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:33.81205+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826014+01:00","closed_at":"2026-02-13T22:46:12.081599+01:00","dependencies":[{"issue_id":"te-df9","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:57:44.264984+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-don","title":"Reconcile init behavior with hook installation expectations","description":"Design expects init to include hook setup flow, but current implementation only initializes storage. Users can believe auto-indexing is enabled when it is not.","acceptance_criteria":"Define and implement explicit init behavior (auto-install hook or clear opt-in messaging/flag); include integration test and docs update.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:34.170636+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821476+01:00","closed_at":"2026-02-14T23:47:26.724354+01:00","close_reason":"Closed"}
{"id":"te-dpz","title":"Clarify redundant alias commands in te --help","description":"`te --help` currently lists both canonical commands and their aliases as separate top-level entries (`search` + `query`, `stats` + `status`). This makes the command list look larger than it is and creates unnecessary ambiguity for new users deciding which command to use.","acceptance_criteria":"- Top-level help presents one canonical command for each action, with aliases either hidden or explicitly marked as aliases.\n- `te query` and `te status` continue to work for backward compatibility.\n- Help text/documentation clearly indicates the preferred command names (`search`, `stats`).","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:32:35.223244+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:58:54.620237+01:00","labels":["cli","ux"]}
{"id":"te-ee5","title":"[Rust Shared Core] Add Python adapter and feature-flagged fallback boundary","description":"Add a Python-side Rust adapter with strict fallback behavior and feature-gated activation.\n\nScope:\n- Introduce `src/town_elder/rust_adapter.py` as the single import boundary for PyO3 module.\n- Add env/config feature flag (e.g., `TE_USE_RUST_CORE`) and helper predicates.\n- Ensure graceful fallback to Python implementations when module unavailable or flag disabled.\n\nCode areas:\n- src/town_elder/rust_adapter.py (new)\n- src/town_elder/config.py (flag wiring if needed)\n- src/town_elder/cli/__init__.py (call sites)\n- tests/ (new adapter behavior tests)","design":"All future Rust call sites should go through this adapter, never direct module imports.","acceptance_criteria":"- Flag-off path is default and fully backward compatible.\n- Missing-extension path does not crash; falls back with clear diagnostic messaging.\n- Adapter unit tests cover flag on/off + import failure scenarios.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:54.550671+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T23:46:14.444804+01:00","closed_at":"2026-02-17T23:46:14.444804+01:00","close_reason":"Closed","labels":["interop","python","safety"],"dependencies":[{"issue_id":"te-ee5","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:51:11.786413+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-ejm","title":"hook commands fail when .git gitdir path is relative (submodules/worktrees)","description":"Hook commands mis-detect valid repositories when `.git` is a file with a relative `gitdir:` entry (common in submodules and some worktree setups).\n\nRepro (real submodule case):\n1. Create parent and child repos.\n2. Add child as submodule to parent (`git -c protocol.file.allow=always submodule add ...`).\n3. Confirm submodule `.git` contains a relative path like `gitdir: ../.git/modules/submod`.\n4. Run:\n   `uv run --project /Users/bylin/Code/town_elder te hook status --repo \u003cparent\u003e/submod`\n\nActual:\n- Command exits with `Not a git repository`.\n\nExpected:\n- Hook commands should work for submodules/worktrees with `.git` pointer files.\n\nImpact:\n- `te hook status/install/uninstall` do not work on submodules and some worktree layouts.\n\nLikely cause:\n- `_get_git_dir()` returns `Path(actual_git_dir)` directly and does not resolve relative paths against `repo_path`.\n- File: `src/town_elder/cli/__init__.py:48` and `src/town_elder/cli/__init__.py:60`.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T05:06:35.205716+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T05:16:43.373823+01:00","closed_at":"2026-02-16T05:16:43.373823+01:00","close_reason":"Closed"}
{"id":"te-emf","title":"Stop swallowing vector store operational errors","description":"Vector store methods currently suppress exceptions and hide failures.","acceptance_criteria":"1) get/delete/count/search wrap backend failures in typed errors instead of silent pass. 2) CLI surfaces actionable error messages. 3) Tests cover failure propagation.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:33.792933+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819214+01:00","closed_at":"2026-02-14T19:28:55.950036+01:00"}
{"id":"te-epe","title":"Add integration tests for hook launcher portability (uv absent, te/python fallback)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:36:20.786763+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:10:30.852942+01:00","closed_at":"2026-02-16T01:10:30.852942+01:00","close_reason":"Closed"}
{"id":"te-f97","title":"[Rust Shared Core] Port file scanning and exclude matching with parity","description":"Implement Rust file scanning with deterministic ordering and exclusion behavior parity.\n\nScope:\n- Port default extension/exclude logic from Python scanner.\n- Support additive custom excludes.\n- Preserve deterministic sorted output ordering.\n\nCode areas:\n- rust/crates/te-core/src/lib.rs (or module split)\n- rust/src/lib.rs\n- src/town_elder/indexing/file_scanner.py\n- tests/test_file_scanner.py","design":"Mirror Python semantics first; optimize traversal internals only after parity is locked.","acceptance_criteria":"- Rust scanner output matches Python scanner output on fixture trees.\n- Deterministic ordering guaranteed across repeated runs.\n- Existing scanner tests pass with a Rust-backed parity path added.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:23.579424+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:41:56.653618+01:00","closed_at":"2026-02-18T23:41:56.653618+01:00","close_reason":"Closed","labels":["filesystem","indexing","rust"],"dependencies":[{"issue_id":"te-f97","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:50:10.459676+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-f97","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:50:20.825693+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-fnp","title":"Propagate --data-dir into installed post-commit hook","description":"The generated hook script hardcodes 'te commit-index --repo ...' and drops any configured --data-dir, causing auto-indexing to write into the wrong store for repos initialized with a custom data directory.","acceptance_criteria":"Hook install writes a script that preserves configured data dir; commits index into the same store used by init/add/search; add regression test for custom data-dir hook flow.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:03.265964+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813912+01:00","closed_at":"2026-02-14T23:33:32.487309+01:00","close_reason":"Closed"}
{"id":"te-gyg","title":"hook install crashes in git worktrees where .git is a file","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:06.976727+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:20.767209+01:00","closed_at":"2026-02-16T06:08:20.767211+01:00"}
{"id":"te-h32","title":"commit-index crashes when index_state.json has non-dict repos payload","description":"## Summary\n`te commit-index` crashes with an unhandled `AttributeError` if `index_state.json` contains `{\"repos\": \u003cnon-dict\u003e}` (for example a string).\n\n## Reproduction\n1. Initialize repo and run `te init`.\n2. Write malformed-but-valid JSON to `.town_elder/index_state.json`, e.g. `{\"repos\":\"oops\"}`.\n3. Run `te commit-index --limit 1`.\n\nObserved: command exits with traceback ending in `AttributeError: \"str\" object has no attribute \"get\"`.\nExpected: command should treat malformed state as empty/recoverable and continue safely (or emit a friendly validation error without traceback).\n\n## Evidence\n`_load_index_state()` in `src/town_elder/cli/__init__.py` assumes `state[\"repos\"]` is a dict and calls `.get(...)` without type-checking, unlike `_save_index_state()` which already guards against non-dict `repos`.\n\n## Impact\nCorrupted or manually edited state files can hard-crash commit indexing, breaking automation and hooks.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:26.074306+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.007095+01:00","closed_at":"2026-02-16T06:08:21.007096+01:00","close_reason":"Fixed in bb52f8a - added type check in _load_index_state()"}
{"id":"te-hcp","title":"Hook commands crash on missing/invalid --repo paths","description":"## Summary\n`te hook install`, `te hook uninstall`, and `te hook status` crash with uncaught tracebacks when `--repo` points to a missing path or a regular file.\n\n## Reproduction\n1. Run `te hook status --repo /tmp/does-not-exist-towne`.\n2. Run `te hook install --repo /tmp/does-not-exist-towne`.\n3. Run `te hook uninstall --repo /tmp/does-not-exist-towne`.\n4. Run `te hook status --repo \u003cpath-to-regular-file\u003e`.\n\n## Expected\nEach command should print a friendly error (for example, \"Not a git repository\") and exit cleanly with a CLI error code.\n\n## Actual\nEach command raises an uncaught `FileNotFoundError`/`NotADirectoryError` traceback.\n\n## Suspected Cause\n`_get_common_git_dir` only catches `subprocess.CalledProcessError`, but `subprocess.run(..., cwd=repo_path)` can raise `FileNotFoundError` and `NotADirectoryError` before Git is invoked (`src/town_elder/cli/__init__.py:72`).\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T07:14:22.357457+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T07:36:24.169945+01:00","closed_at":"2026-02-16T07:36:24.169945+01:00","close_reason":"Closed"}
{"id":"te-hxw","title":"Preserve raw content when exporting JSON to stdout","description":"Export to stdout currently goes through Rich console print, which can interpret bracket markup and mutate payload content. Export output must be byte-accurate JSON or JSONL.","acceptance_criteria":"1) export --output - emits raw JSON/JSONL bytes without Rich markup interpretation. 2) Payloads containing bracket-style text (e.g. [brackets], [bold]x[/bold]) round-trip unchanged. 3) Regression tests validate stdout parsing and exact content preservation for markup-like strings.","notes":"BDD review (2026-02-15) repro: add text 'contains [brackets] and [bold]tags[/bold]', then te export --output - --format json. Current output mutates text to 'contains  and tags'.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.257971+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:30:43.039463+01:00","closed_at":"2026-02-15T15:30:43.039463+01:00","close_reason":"Closed"}
{"id":"te-i5n","title":"commit-index masks fatal git errors as 'No commits to index'","description":"## Summary\n`te commit-index` treats any `git log` failure with exit code 128 as \"No commits to index\" and exits successfully. This masks fatal repository errors as success.\n\n## Reproduction\n1. Create a directory with an empty `.git/` folder (not a real repo).\n2. Run `te init --data-dir \u003cdir\u003e/.town_elder --path \u003cdir\u003e`.\n3. Run `te commit-index --data-dir \u003cdir\u003e/.town_elder --repo \u003cdir\u003e`.\n\nObserved: command prints `No commits to index.` and exits `0`.\nExpected: command reports git failure (e.g., not a git repository/corrupt repo) and exits non-zero.\n\n## Evidence\n- `src/town_elder/cli/__init__.py:777` catches `subprocess.CalledProcessError`.\n- `src/town_elder/cli/__init__.py:779` special-cases `returncode == 128` as empty history.\n- Git uses 128 for many fatal errors, not only empty repositories.\n\n## Impact\nAutomation can falsely report successful indexing while repository discovery is broken, leaving commit history unindexed.\n","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T04:29:37.655508+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.127357+01:00","closed_at":"2026-02-16T06:08:21.127359+01:00"}
{"id":"te-iqw","title":"Fix incremental commit indexing backlog loss when pending \u003e limit","description":"commit-index uses limited history and updates last_indexed marker in a way that can strand older unindexed commits if new commits exceed --limit between runs.","acceptance_criteria":"Indexing guarantees no commit gaps across runs; state advancement is correct under high commit velocity; add regression test with synthetic history \u003e limit.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:44.469209+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821266+01:00","closed_at":"2026-02-14T23:47:26.720633+01:00","close_reason":"Closed"}
{"id":"te-j3a","title":"Regenerate lockfile and validate PyPI metadata in networked CI","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T10:44:53.501206+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T00:02:57.091572+01:00","closed_at":"2026-02-18T00:02:57.091572+01:00","close_reason":"Closed"}
{"id":"te-j50","title":"Eliminate get_config cache leakage across in-process CLI invocations","description":"get_config is cached while default resolution depends on current working directory. In-process multi-invocation use can return stale cwd-derived configuration and violate invocation scoping.","acceptance_criteria":"1) Config resolution is invocation-safe within a process. 2) Repeated calls across different cwd values do not return stale paths. 3) Add deterministic regression test that covers at least three cwd transitions.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.146862+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:49:11.108035+01:00","closed_at":"2026-02-15T15:49:11.108039+01:00"}
{"id":"te-ld0","title":"te-service-factory","description":"Create service factory for dependency injection and port implementations","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:57.104565+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824334+01:00","closed_at":"2026-02-14T13:57:28.098646+01:00","close_reason":"Service factory implemented: create_embedder, create_vector_store, create_git_runner, create_diff_parser all working","dependencies":[{"issue_id":"te-ld0","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:57:08.28687+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ld0","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:08.416662+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ld0","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:08.516925+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-lm6","title":"Fix dangerous -h short option collision in te init","description":"## Summary\n`te init` currently binds `-h` to `--install-hook`, which conflicts with the universal CLI expectation that `-h` means help. This can trigger side effects (database initialization and hook installation attempt) when a user only wanted help.\n\n## Why This Matters\nThis is a high-risk UX/safety issue:\n- Users accustomed to `-h` can accidentally mutate project state.\n- Running `te init -h` can create `.town_elder` and attempt hook changes.\n- It violates standard Typer/Click-style command behavior and principle of least surprise.\n\n## Evidence\nCommand run:\n```bash\nuv run te init -h\n```\nObserved behavior:\n- Command initialized a database instead of printing help.\n- Output included initialization success text and hook-related warning.\n\n## Current Implementation\nFile:\n- `src/town_elder/cli/__init__.py:265`\n- `src/town_elder/cli/__init__.py:268`\n\nRelevant option definition:\n- `install_hook` is defined as `--install-hook` with short flag `-h`.\n\n## Expected Behavior\n- `te init -h` should show command help and exit successfully without side effects.\n- `--install-hook` should still be available for explicit hook installation.\n\n## Proposed Change\n1. Remove `-h` alias from `--install-hook`.\n2. Keep `--install-hook` long form only, or reassign a non-conflicting short option (e.g., `-i`).\n3. Ensure standard help behavior is restored for `te init -h` and `te init --help`.\n4. Update any docs/help text that references short flag usage.\n\n## Tests To Add/Update\n- CLI integration test asserting `te init -h` prints usage/help and does **not** initialize storage.\n- CLI test asserting `te init --install-hook` still installs hook when requested.\n\n## Acceptance Criteria\n- `te init -h` displays help and exits `0`.\n- No `.town_elder` directory is created when running help.\n- `te init --install-hook` remains functional.\n- Tests cover regression.\n","notes":"Execution order: Phase 1/4. Can be implemented immediately in parallel with te-68r.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:43:23.678197+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:13:37.570473+01:00","closed_at":"2026-02-15T18:13:37.570473+01:00","close_reason":"Closed","labels":["phase-1"]}
{"id":"te-nae","title":"Validate search/query --top-k and reject zero/negative values","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:33:44.385303+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T22:56:21.342299+01:00","closed_at":"2026-02-15T22:56:21.342299+01:00","close_reason":"Fixed in commit 3028939"}
{"id":"te-nch","title":"hook install succeeds with explicit --data-dir even when DB is not initialized","description":"## Summary\n`te hook install` accepts an explicit `--data-dir` path that does not exist and still installs the post-commit hook.\n\n## Reproduction\n1. Create a git repo with no Town Elder initialization.\n2. Run `te --data-dir /tmp/nonexistent hook install --repo \u003crepo\u003e`.\n\nObserved: exit code 0, hook is installed.\nExpected: command should fail with a friendly \"Database not initialized\" message (consistent with other commands and docs that require running `te init` first).\n\n## Evidence\nIn `src/town_elder/cli/__init__.py`, `hook install` calls `get_config(data_dir=data_dir)` but does not validate `config.data_dir.exists()`. Passing explicit `--data-dir` bypasses default-path `ConfigError` checks.\n\n## Impact\nHooks are installed in a broken state and fail later at commit time, creating delayed and confusing failures for users.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:31.64778+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:16:38.30725+01:00","closed_at":"2026-02-16T06:16:38.30725+01:00","close_reason":"Closed"}
{"id":"te-nns","title":"DiffParser mis-parses git diff headers for filenames containing spaces","description":"## Summary\n`DiffParser.parse()` extracts the file path by doing `line.split()` on `diff --git ...` headers and taking the last token.\nThis breaks quoted paths with spaces.\n\n## Impact\nCommit/file indexing stores incorrect file paths for diffs that touch files with spaces.\nSearch and history context become misleading.\n\n## Reproduction\nUsing this diff header:\n`diff --git \\\"a/my file.txt\\\" \\\"b/my file.txt\\\"`\n`DiffParser().parse(...)` returns `path='file.txt\"'` instead of `my file.txt`.\n\n## Expected\nQuoted git paths should be parsed correctly, preserving full filename.\n\n## Actual\nPath is truncated/corrupted.\n\n## Code References\n- `src/town_elder/git/diff_parser.py:41`\n- `src/town_elder/git/diff_parser.py:44`\n- `src/town_elder/git/diff_parser.py:45`","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:33:06.351844+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:50:08.43025+01:00"}
{"id":"te-nqf","title":"[Rust Native CLI] Implement `te-rs` clap CLI using shared `te-core` logic","description":"Build native `te-rs` CLI with clap on top of `te-core` shared logic.\n\nScope:\n- Implement clap command structure mirroring key Python flows (at minimum: index files path + index commits path + search/read path, depending on backend readiness from prior ticket).\n- Ensure command help/flags are documented and testable.\n- Keep shared business logic in `te-core`, not in binary crate.\n\nCode areas:\n- rust/src/main.rs\n- rust/crates/te-core/src/lib.rs\n- docs/native-cli.md (new)\n- tests or integration harness under rust/ (new)","design":"If full parity is blocked by storage bindings, ship explicitly documented MVP subcommands first.","acceptance_criteria":"- `cargo run --manifest-path rust/Cargo.toml --bin te-rs -- --help` shows working command tree.\n- Native CLI executes at least one end-to-end indexing/query workflow using selected backend strategy.\n- Business logic lives in `te-core` and is reused (no duplicated algorithmic logic in main.rs).","status":"closed","priority":1,"issue_type":"feature","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:38.146128+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:42:11.846496+01:00","closed_at":"2026-02-18T23:42:11.846496+01:00","close_reason":"Closed","labels":["cli","distribution","rust"],"dependencies":[{"issue_id":"te-nqf","depends_on_id":"te-9ex","type":"blocks","created_at":"2026-02-17T18:52:54.439762+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-nqf","depends_on_id":"te-pqp","type":"blocks","created_at":"2026-02-17T18:53:04.711736+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-nqf","depends_on_id":"te-7nz","type":"blocks","created_at":"2026-02-17T18:53:14.985434+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-nqf","depends_on_id":"te-f97","type":"blocks","created_at":"2026-02-17T18:53:25.26045+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-nqf","depends_on_id":"te-d0q","type":"blocks","created_at":"2026-02-17T18:53:35.522811+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-o39","title":"hook uninstall exits 0 for non-git paths instead of reporting invalid repo","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:27.703698+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:20.887061+01:00","closed_at":"2026-02-16T06:08:20.887062+01:00"}
{"id":"te-oc7","title":"te-cli-add-command","description":"Implement 'te add' command to add documents to the vector store","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:44.189478+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828886+01:00","closed_at":"2026-02-14T13:58:08.620112+01:00","close_reason":"add command already implemented and working","dependencies":[{"issue_id":"te-oc7","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:00.055969+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-oc7","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:00.162288+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-oc7","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.321436+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-ohd","title":"Increase coverage of high-risk CLI and git runner paths","description":"Coverage is weak in high-risk orchestration code, especially CLI command flows and git runner failure paths. Add focused tests for error handling and subprocess edge cases.","acceptance_criteria":"1) Add tests for critical untested branches in CLI and git runner code. 2) Validate exit codes and user-facing errors on failure paths. 3) Increase confidence for release-critical behavior.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.146869+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:13:28.606566+01:00","closed_at":"2026-02-15T16:13:28.606566+01:00","close_reason":"Closed"}
{"id":"te-oua","title":"Expand _is_te_hook detection to support python3/python3.x interpreter names","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:34.512704+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.811368+01:00","closed_at":"2026-02-16T02:02:16.811368+01:00","close_reason":"Closed"}
{"id":"te-pam","title":"te-git-diff-parser","description":"Implement git diff parsing to extract file changes from commits","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:43.054771+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825549+01:00","closed_at":"2026-02-13T22:46:12.107607+01:00","dependencies":[{"issue_id":"te-pam","depends_on_id":"te-5n1","type":"blocks","created_at":"2026-02-13T21:56:54.151768+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-pqp","title":"[Rust Shared Core] Port deterministic doc-id and file-state helper logic","description":"Port deterministic document-id and file-state helper logic into `te-core` with parity tests.\n\nScope:\n- Implement Rust equivalents for:\n  - `_build_file_doc_id`\n  - chunk index normalization helpers\n  - path/doc-id input normalization helpers used for deletion and migration safety\n- Expose functions through PyO3 for Python parity tests.\n\nCode areas:\n- rust/crates/te-core/src/lib.rs\n- rust/src/lib.rs\n- tests/test_file_hash_state.py\n- tests/test_index_files_incremental_regressions.py\n- src/town_elder/cli/__init__.py (adapter call sites, guarded)","design":"Treat parity mismatches as blockers unless intentionally documented in contract and approved.","acceptance_criteria":"- Rust helper outputs match current Python outputs on all contract fixtures.\n- New/updated tests assert Python-vs-Rust parity for deterministic ids and normalized metadata.\n- Flag-off behavior remains byte-for-byte unchanged.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:47:02.913711+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:41:51.591073+01:00","closed_at":"2026-02-18T23:41:51.591073+01:00","close_reason":"Closed","labels":["indexing","parity","rust"],"dependencies":[{"issue_id":"te-pqp","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:49:29.368178+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-pqp","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:49:39.644481+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-qi6","title":"Handle missing .te config paths without Python traceback","description":"Commands such as stats, search, hook install, and export can raise ConfigError before command-level handling when run outside initialized directories. This currently leaks Python tracebacks instead of actionable CLI errors.","acceptance_criteria":"1) In a directory without .te and without --data-dir, user-facing commands fail with friendly CLI errors (no traceback) and non-zero exit code. 2) Coverage includes at least stats, status, search/query, and export. 3) Error output clearly instructs to run te init or pass --data-dir. 4) Regression tests assert traceback absence and stable behavior.","notes":"BDD review (2026-02-15): reproduced traceback leakage with: (a) cd \u003cfresh-dir\u003e \u0026\u0026 uv run --project /Users/bylin/Code/te te stats, and (b) cd \u003cfresh-dir\u003e \u0026\u0026 uv run --project /Users/bylin/Code/te te search 'test'. Both currently raise ConfigError traceback before command-level handling.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:35.815433+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T14:54:58.004005+01:00","closed_at":"2026-02-15T14:54:58.004007+01:00"}
{"id":"te-qnf","title":"Fix export default format selection and stdout behavior","description":"Export fails with default options because format remains unset when output is stdout. Default invocation should produce valid JSON output without requiring --format.","acceptance_criteria":"te export with defaults succeeds and emits valid JSON; explicit json and jsonl modes continue to work; regression test added.","status":"closed","priority":1,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:25:05.0061+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818527+01:00","closed_at":"2026-02-15T01:11:33.85136+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-qnf","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:57.926337+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-qr4","title":"te-query-service","description":"Implement application service for semantic search queries","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.528362+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824585+01:00","closed_at":"2026-02-14T13:58:14.00734+01:00","close_reason":"Query service implemented via te search command","dependencies":[{"issue_id":"te-qr4","depends_on_id":"te-ld0","type":"blocks","created_at":"2026-02-13T21:57:23.956958+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-qr4","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:24.065601+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-qr4","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:24.166868+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-r0p","title":"hook install drops configured data_dir when set via TOWN_ELDER_DATA_DIR","description":"## Summary\n`hook install` only includes `--data-dir` in generated hook script when `data_dir` came from CLI context (`--data-dir`).\nIf `data_dir` is resolved via `TOWN_ELDER_DATA_DIR`, `config.data_dir` is ignored for script generation and hook is written without `--data-dir`.\n\n## Impact\nHooks can write to/read from the wrong database path at commit time (or fail with not-initialized) despite successful setup via env var.\n\n## Reproduction\n1. Set `TOWN_ELDER_DATA_DIR=/tmp/custom_data`.\n2. Run `python -m town_elder init --path \u003crepo\u003e` (no `--data-dir`).\n3. Run `python -m town_elder hook install --repo \u003crepo\u003e`.\n4. Inspect `.git/hooks/post-commit`: no `--data-dir` argument is present.\n\nI reproduced this: generated hook omitted `--data-dir` even though resolved config data dir was custom.\n\n## Expected\nGenerated hook should use resolved `config.data_dir` regardless of whether it came from CLI option or env var.\n\n## Actual\nHook includes `--data-dir` only when CLI option was explicitly passed.\n\n## Code References\n- `src/town_elder/cli/__init__.py:1139`\n- `src/town_elder/cli/__init__.py:1141`\n- `src/town_elder/cli/__init__.py:1151`","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T09:33:29.965814+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T17:53:10.724731+01:00","closed_at":"2026-02-16T17:53:10.724731+01:00","close_reason":"Closed"}
{"id":"te-r6x","title":"te-cli-search-command","description":"Implement 'te search' command for semantic search over indexed documents","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:55.878327+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828551+01:00","closed_at":"2026-02-14T13:58:08.724461+01:00","close_reason":"search command already implemented and working","dependencies":[{"issue_id":"te-r6x","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:13.711155+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-r6x","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:13.837459+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-r6x","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.421661+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-rhg","title":"Update README with explicit uv CLI run commands","description":"Clarify README usage so contributors can run the CLI reliably with uv in both local repo and external target-repo workflows.","acceptance_criteria":"1) README includes clear examples for `uv run te ...` from project root. 2) README includes `uv run --project /path/to/te te ...` example for operating on another repository. 3) Quick Start and command examples are internally consistent. 4) Any outdated invocation examples are removed.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:08:04.624385+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821907+01:00","closed_at":"2026-02-14T22:24:43.058156+01:00"}
{"id":"te-rin","title":"Make export format flag self-documenting and validated at parse time","description":"`te export --help` shows `--format` as free-form `TEXT` even though only `json` and `jsonl` are accepted. Users discover invalid values only after command execution, and help does not surface allowed choices clearly.","acceptance_criteria":"- `te export --help` displays explicit allowed values for `--format` (e.g., `json|jsonl`) instead of generic `TEXT`.\n- Invalid values are rejected by argument parsing with a clear error before command logic runs.\n- Existing default/auto-detect behavior (`-o` extension fallback) remains documented and covered by tests.","status":"in_progress","priority":3,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:33:26.412393+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:30:33.981891+01:00","labels":["cli","ux"]}
{"id":"te-rtr","title":"Add Ruff linting to te project","description":"Add Ruff as a dev dependency, configure lint rules in pyproject.toml, add a lint command to contributor docs, and include Ruff in CI quality gates.","acceptance_criteria":"1) uv run ruff check src tests runs successfully in dev setup. 2) pyproject includes Ruff configuration with at least baseline rule set and excludes. 3) README/AGENTS docs mention lint command. 4) CI runs Ruff and fails on lint violations.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:44:13.420764+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823611+01:00","closed_at":"2026-02-14T22:43:41.953974+01:00"}
{"id":"te-s27","title":"Batch embedding generation in commit-index to reduce indexing latency","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:36:03.773751+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:04:08.270723+01:00","closed_at":"2026-02-16T01:04:08.270723+01:00","close_reason":"Closed"}
{"id":"te-tsf","title":"[Release] Add maturin + CI artifact pipeline for wheels and native binaries","description":"Add packaging/build automation for PyO3 wheels and native binary artifacts.\n\nScope:\n- Configure `maturin` build path for Python extension distribution.\n- Add CI jobs to build/test wheel artifacts and native `te-rs` binaries per target.\n- Ensure release artifact naming/versioning is documented.\n\nCode areas:\n- pyproject.toml (maturin configuration)\n- .github/workflows/* (build/release workflows)\n- README.md / docs/release.md (artifact install instructions)","design":"Keep packaging additive; avoid breaking existing uv workflow during migration.","acceptance_criteria":"- CI can build extension wheels and native binaries from one source tree.\n- Artifact outputs are versioned and discoverable in release process.\n- Python-only install path still works when Rust extension is not present.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:48:48.434566+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-18T23:42:11.853313+01:00","closed_at":"2026-02-18T23:42:11.853313+01:00","close_reason":"Closed","labels":["ci","release","rust"],"dependencies":[{"issue_id":"te-tsf","depends_on_id":"te-vby","type":"blocks","created_at":"2026-02-17T18:53:45.800001+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-tsf","depends_on_id":"te-nqf","type":"blocks","created_at":"2026-02-17T18:53:56.064072+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-ute","title":"te-cli-stats-command","description":"Implement 'te stats' command to show indexing statistics and storage info","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:05.103778+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828204+01:00","closed_at":"2026-02-14T13:58:08.831627+01:00","close_reason":"stats command already implemented and working","dependencies":[{"issue_id":"te-ute","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:17.406896+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ute","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.520377+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-vay","title":"Handle non-UTF8 git hook files without crashing hook install/status/uninstall","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:00.838454+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T23:06:54.516167+01:00","closed_at":"2026-02-15T23:06:54.516167+01:00","close_reason":"Closed"}
{"id":"te-vby","title":"[Rust Shared Core] Bootstrap workspace, te-core crate, PyO3, and clap skeleton","description":"Bootstrap Rust workspace and Python extension scaffolding without changing production behavior.\n\nScope:\n- Create Rust workspace layout with:\n  - rust/Cargo.toml (workspace root)\n  - rust/crates/te-core (shared logic crate)\n  - rust/src/lib.rs (PyO3 module entry)\n  - rust/src/main.rs (clap binary entry)\n- Add minimal compile-only functions and wiring.\n- Add build notes for local dev (cargo + maturin commands).\n\nCode areas:\n- rust/Cargo.toml (new)\n- rust/crates/te-core/Cargo.toml + src/lib.rs (new)\n- rust/src/lib.rs (new)\n- rust/src/main.rs (new)\n- docs/ or README.md (build instructions)","design":"Keep module surface intentionally tiny in this step; implementation tickets will expand it.","acceptance_criteria":"- `cargo check --manifest-path rust/Cargo.toml` succeeds.\n- PyO3 module builds locally (documented command path).\n- Existing Python tests remain green with Rust extension absent.\n- No CLI behavior change.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-17T18:46:52.542006+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-17T19:46:34.821583+01:00","closed_at":"2026-02-17T19:46:34.821583+01:00","close_reason":"Closed","labels":["build","interop","rust"],"dependencies":[{"issue_id":"te-vby","depends_on_id":"te-5c3","type":"blocks","created_at":"2026-02-17T18:49:19.09137+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-vdd","title":"te-index-service","description":"Implement application service for indexing documents with embeddings","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.39034+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824835+01:00","closed_at":"2026-02-14T13:58:13.893166+01:00","close_reason":"Index service implemented via te index and commit-index commands","dependencies":[{"issue_id":"te-vdd","depends_on_id":"te-ld0","type":"blocks","created_at":"2026-02-13T21:57:15.565831+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:15.676187+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:15.778841+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-pam","type":"blocks","created_at":"2026-02-13T21:57:15.879123+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-vut","title":"te-config-management","description":"Implement configuration management with pydantic-settings, environment variable support, and config file loading","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:27.086572+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829953+01:00","closed_at":"2026-02-13T22:46:12.043096+01:00","dependencies":[{"issue_id":"te-vut","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:38.848645+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-wd1","title":"Improve --data-dir discoverability and placement UX","description":"`--data-dir` is a top-level option only, so `te search --data-dir \u003cpath\u003e ...` fails with `No such option`. Subcommand help pages also do not surface global options, making this behavior hard to discover and easy to misuse.","acceptance_criteria":"- Either accept `--data-dir` in subcommand position or provide a targeted error that suggests the correct placement (`te --data-dir \u003cpath\u003e \u003ccommand\u003e`).\n- Subcommand help/docs clearly indicate global options and where they must appear.\n- Add regression tests covering both correct and incorrect placement behavior with user-friendly guidance.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T17:34:09.499438+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:25:45.12679+01:00","closed_at":"2026-02-16T18:25:45.12679+01:00","close_reason":"Closed","labels":["cli","ux"]}
{"id":"te-wd2","title":"Hardcoded git path breaks on non-standard installations","description":"## Summary\nCLI uses hardcoded `/usr/bin/git` path instead of using `shutil.which()` or PATH lookup.\n\n## Impact\nHook detection and commit indexing fail on systems where git is installed elsewhere (e.g., Homebrew on macOS at `/opt/homebrew/bin/git`, different Linux distributions).\n\n## Code References\n- `src/town_elder/cli/__init__.py:84-85` (`git rev-parse`)\n- `src/town_elder/cli/__init__.py:109-110` (another git call)\n\n## Expected\nUse `shutil.which(\"git\")` or rely on PATH to find git dynamically.\n\n## Actual\nHardcoded `/usr/bin/git` path may not exist on all systems.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T18:30:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:45:13.320066+01:00","closed_at":"2026-02-16T18:45:00+01:00","labels":["bug","portability"]}
{"id":"te-wd3","title":"DiffParser silently loses diff content on malformed headers","description":"## Summary\nDiffParser uses `_extract_b_path(line)` which can return `None` for malformed diff headers. When this happens, `current_file` retains its previous value (or `None`), and subsequent diff content is silently lost or associated with the wrong file.\n\n## Impact\nGit diffs with malformed headers lead to silent data loss - some diff content is not indexed.\n\n## Code References\n- `src/town_elder/git/diff_parser.py:119-124`\n- `src/town_elder/git/diff_parser.py:140-142`\n\n## Expected\nRaise an error or warning when diff header parsing fails, rather than silently continuing.\n\n## Actual\nContent lines are silently ignored when `current_file` is None.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T18:31:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:49:09.11753+01:00","closed_at":"2026-02-16T18:47:00+01:00","labels":["bug","parsing"]}
{"id":"te-wd4","title":"ZvecStore.upsert has potential race condition","description":"## Summary\nZvecStore.upsert() calls delete() then insert() without checking if delete succeeded. If delete fails for any reason, insert still proceeds, potentially creating duplicate documents or inconsistent state.\n\n## Impact\nConcurrent upsert operations or transient delete failures can lead to duplicate documents or data inconsistency.\n\n## Code References\n- `src/town_elder/storage/vector_store.py:130-138`\n\n## Expected\nVerify delete success before proceeding with insert, or use a combined operation if the library supports it.\n\n## Actual\ndelete() result is not checked before insert().","status":"closed","priority":3,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T18:32:00+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T18:54:13.166235+01:00","closed_at":"2026-02-16T18:54:13.166235+01:00","close_reason":"Closed","labels":["bug","concurrency"]}
{"id":"te-xe2","title":"Scope commit-index incremental state by repository","description":"## Summary\n`commit-index` stores incremental cursor state as a single global `last_indexed_commit` in one `index_state.json` per data-dir. This is incorrect when one data-dir is reused across multiple repositories.\n\n## Why This Matters\n- Multi-repo workflows are explicitly supported via `--data-dir` and `--repo`.\n- Global cursor causes cross-repo interference.\n- A commit hash from repo A is not meaningful in repo B, so repo B repeatedly enters \"sentinel not found\" behavior.\n\n## Evidence\nBehavior observed with two different repos sharing one data-dir:\n1. Index repo A -\u003e state written with repo A hash.\n2. Index repo B -\u003e warning repeats:\n   - `Warning: Last indexed commit not found in history.`\n   - `Indexing all available commits without advancing state.`\n3. State remains pinned to repo A hash, so repo B never gets a stable incremental cursor.\n\n## Current Implementation\nFiles:\n- `src/town_elder/cli/__init__.py:652`\n- `src/town_elder/cli/__init__.py:658`\n- `src/town_elder/cli/__init__.py:779`\n- `src/town_elder/cli/__init__.py:782`\n\nCurrent state format:\n```json\n{\"last_indexed_commit\": \"\u003chash\u003e\"}\n```\nNo repo keying is present.\n\n## Proposed Change\n1. Make incremental state repo-scoped.\n2. Use a deterministic repo identifier (e.g., hash of canonical git top-level path, optionally include remote URL when available).\n3. Store state structure like:\n   ```json\n   {\n     \"repos\": {\n       \"\u003crepo-id\u003e\": {\n         \"last_indexed_commit\": \"\u003chash\u003e\",\n         \"repo_path\": \"\u003ccanonical-path\u003e\",\n         \"updated_at\": \"\u003ciso8601\u003e\"\n       }\n     }\n   }\n   ```\n4. Add backward-compatible migration logic:\n   - If legacy global key exists, map it to current repo once, then persist new schema.\n5. Ensure stale/missing sentinel handling remains safe per repo.\n\n## Tests To Add/Update\n- New regression test: two repos sharing same data-dir maintain independent cursors and do not cross-trigger sentinel warnings.\n- Migration test from legacy schema to repo-scoped schema.\n- Existing commit-index state safety tests should continue passing.\n\n## Acceptance Criteria\n- Incremental indexing state is isolated by repo.\n- Re-indexing repo B after repo A does not reuse repo A cursor.\n- `index_state.json` schema supports multiple repos and migration from legacy single-key format.\n","notes":"Execution order: Phase 2/4 prerequisite. Complete before te-4lm because scalable indexing needs repo-scoped state.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:44:12.293585+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:16:12.726009+01:00","closed_at":"2026-02-15T18:16:12.726009+01:00","close_reason":"Closed","labels":["phase-2"]}
{"id":"te-xhb","title":"Align embedding fallback error messaging with actual CLI capabilities","description":"Embedder error text references a fallback CLI flag that does not exist. Either implement the flag end to end or correct the message so users are not misled.","acceptance_criteria":"1) Error messaging reflects real CLI capabilities. 2) If fallback is supported, add CLI option and docs; otherwise remove the flag reference. 3) Add or update tests accordingly.","status":"closed","priority":3,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.153641+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:20:56.616793+01:00","closed_at":"2026-02-15T16:20:56.616793+01:00","close_reason":"fixed"}
{"id":"te-ymh","title":"Hook install/uninstall crash with traceback on permission errors","description":"## Summary\n`te hook install` and `te hook uninstall` do not handle filesystem permission failures. When `.git/hooks` is not writable, both commands crash with a Python traceback instead of returning a friendly CLI error.\n\n## Reproduction\n1. Create a git repo and initialize Town Elder.\n2. Make hooks directory read-only: `chmod 0555 \u003crepo\u003e/.git/hooks`.\n3. Run `te hook install --repo \u003crepo\u003e`.\n4. Run `te hook uninstall --repo \u003crepo\u003e --force` (with a hook present).\n\nObserved: uncaught `PermissionError` tracebacks.\nExpected: clean error message + non-zero exit code without traceback.\n\n## Evidence\n- `src/town_elder/cli/__init__.py:1034` writes hook file without catching write/chmod errors.\n- `src/town_elder/cli/__init__.py:1074` unlinks hook file without handling `OSError`/`PermissionError`.\n\n## Impact\nCommon filesystem permission states produce noisy crashes and poor UX in automation/CI contexts.\n","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T04:29:17.602608+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:08:21.246727+01:00","closed_at":"2026-02-16T06:08:21.246728+01:00"}
{"id":"te-z4c","title":"get_diffs_batch can omit requested hashes and include wrong commits","description":"`GitRunner.get_diffs_batch()` does not reliably return diffs for the exact hashes requested when the input list is non-contiguous.\n\nRepro:\n1. Create a linear repo with 5 commits.\n2. Request diffs for newest and oldest hashes only.\n3. Call `get_diffs_batch([newest_hash, oldest_hash])`.\n\nObserved in local repro:\n- Requested: `[76257822..., 7b089b69...]` (newest + oldest)\n- Returned keys: `[76257822..., c26a250c...]` (newest + second newest)\n- `oldest_hash` was missing.\n\nActual:\n- Method may return diffs for unintended commits and omit requested commits.\n\nExpected:\n- Return dictionary should contain exactly the requested commit hashes (or explicit per-hash failure), regardless of graph position/order.\n\nImpact:\n- Incorrect diff indexing for any caller that passes sparse or custom hash sets.\n- Makes the API behavior surprising and unsafe outside contiguous-history assumptions.\n\nLikely cause:\n- Uses `git log --max-count=\u003cn\u003e \u003chashes...\u003e`, which traverses revision history rather than selecting exact commits.\n- File: `src/town_elder/git/runner.py:236` and `src/town_elder/git/runner.py:257`.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T05:07:40.344542+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T06:25:13.6979+01:00","closed_at":"2026-02-16T06:25:13.697903+01:00"}
{"id":"te-zda","title":"Guard te init --force from deleting arbitrary directories","description":"te init --force currently deletes data_dir recursively without constraining the target to te-managed storage. If users pass an unsafe --data-dir, unrelated files can be removed. Add path safety checks and fail closed.","acceptance_criteria":"1) te init --force refuses unsafe --data-dir targets that are not clearly te-managed storage. 2) It must fail closed for broad paths (e.g. repo root/home/other non-te dirs) and explain why. 3) Deletion is permitted only for validated te storage targets. 4) Regression tests cover safe and unsafe targets and verify no unrelated files are deleted.","notes":"BDD review (2026-02-15): confirmed destructive behavior. Repro: initialize with --data-dir \u003ctmp\u003e/unsafe-dir, create \u003ctmp\u003e/unsafe-dir/subdir/marker.txt, rerun te init --force with same --data-dir. marker.txt is deleted (observed output: MARKER_DELETED).","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.186099+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T14:35:28.131034+01:00","closed_at":"2026-02-15T14:35:28.131036+01:00"}
{"id":"te-zph","title":"te-test-infrastructure","description":"Set up pytest, test directory structure, and basic unit tests for core components","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:28.936164+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826257+01:00","closed_at":"2026-02-14T14:30:26.926211+01:00","close_reason":"Test infrastructure set up with pytest, conftest.py, and 20/21 tests passing. Tests cover embedder, vector store, and diff parser.","dependencies":[{"issue_id":"te-zph","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:54:21.122086+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-zph","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:21.229713+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-zph","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:21.340292+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-zps","title":"Harden GitRunner commit parsing against delimiter collisions","description":"## Summary\nGit commit parsing currently depends on splitting `git log` lines by a literal delimiter (`|||`). Commit subjects can legally contain this delimiter, causing incorrect field parsing and potentially malformed indexing metadata.\n\n## Why This Matters\n- Parsing bugs in commit metadata can silently degrade history indexing quality.\n- Incorrect hash/message/author/date extraction can break search relevance and debugging trust.\n\n## Current Implementation\nFiles:\n- `src/town_elder/git/runner.py:66`\n- `src/town_elder/git/runner.py:78`\n\nCurrent format/parsing approach:\n- Uses `--format=%H|||%s|||%an|||%ad|||%f`\n- Splits line with `.split(\"|||\")`\n\nThis is not robust to delimiter collision in commit subject `%s`.\n\n## Reproduction Scenario\n1. Create a commit with subject containing `|||`, e.g.:\n   ```bash\n   git commit -m \"fix parser ||| edge case\"\n   ```\n2. Run `commit-index` or `GitRunner.get_commits()`.\n3. Observe malformed parsed fields or inconsistent commit metadata.\n\n## Proposed Change\nReplace ad-hoc delimiter parsing with robust record/field separators:\n1. Use null-safe separators in git format output (e.g., `%x1f` field separator and `%x1e` record separator, or `-z`-based strategy).\n2. Parse by explicit control characters rather than human text delimiters.\n3. Prefer ISO-8601 strict datetime (`%aI`) for reliable parsing.\n4. Keep backward-compatible behavior for existing callers.\n\n## Tests To Add/Update\n- New unit test where commit subject contains `|||`.\n- Additional test with unusual punctuation/Unicode in commit subject.\n- Ensure parsed `Commit` objects still populate hash/message/author/date/files correctly.\n\n## Acceptance Criteria\n- Commits with delimiter-like text in subject parse correctly.\n- `GitRunner.get_commits()` is robust to arbitrary subject content.\n- Regression tests cover delimiter collision cases.\n","notes":"Execution order: Phase 2/4 prerequisite. Complete before te-4lm to avoid refactoring parser twice.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:45:02.655265+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T20:10:15.053904+01:00","closed_at":"2026-02-15T20:10:15.053904+01:00","close_reason":"Closed","labels":["phase-2"]}
