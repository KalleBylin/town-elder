{"id":"te-0bw","title":"Make GitRunner.get_diffs_batch return all requested hashes in merge/non-linear history","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:32.01926+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:46:33.489325+01:00","closed_at":"2026-02-16T02:46:33.489325+01:00","close_reason":"Closed"}
{"id":"te-0d6","title":"Review remediation: fix CLI/runtime/data integrity regressions","description":"Track all findings from principal review (Feb 2026) and restore expected Town Elder CLI behavior, data integrity, and maintainability.","acceptance_criteria":"All child issues closed; te query/status/export/index/commit-index/hook workflows validated by tests; no known critical regressions remain.","notes":"Behavior-driven review run on 2026-02-15: 15/15 CLI workflow scenarios passed in isolated temp repos (init/add/search/query/index/commit-index/hook/export/stats guardrails). Full test suite also passed (63/63). Remaining high-priority gaps are focused in edge-case correctness and safety, tracked in te-qi6, te-zda, te-hxw, and te-0d6.13.","status":"closed","priority":1,"issue_type":"epic","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:19:25.423736+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:04:40.138717+01:00","closed_at":"2026-02-15T16:04:40.138717+01:00","close_reason":"Closed"}
{"id":"te-0d6.1","title":"Fix query and status alias commands crashing at runtime","description":"te query and te status crash with AttributeError because alias handlers call search.callback and stats.callback instead of shared helper functions.","acceptance_criteria":"te query and te status execute successfully with no AttributeError; add CLI regression tests covering both aliases.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:12.514051+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813376+01:00","closed_at":"2026-02-15T00:42:03.318726+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.1","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:12.515127+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.10","title":"Fix ZvecStore insert contract to avoid silent zero vectors","description":"The public ZvecStore insert API stores zero vectors, producing non-semantic retrieval behavior for callers that use this path.","acceptance_criteria":"Insert path cannot silently store zero vectors unless explicitly requested as fallback; API contract and tests document and verify expected vector behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:40.959348+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816478+01:00","closed_at":"2026-02-15T09:41:00.026232+01:00","dependencies":[{"issue_id":"te-0d6.10","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:40.960248+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.11","title":"Stop swallowing indexing errors in IndexService","description":"IndexService index_file catches broad exceptions and returns None, hiding root causes and making indexing failures hard to diagnose.","acceptance_criteria":"Operational failures are surfaced or explicitly reported with actionable context; tests verify failure paths are visible to callers.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:46.497228+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820314+01:00","closed_at":"2026-02-15T09:58:51.374807+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.11","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:46.498172+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.12","title":"Add regression tests for critical CLI and indexing workflows","description":"Current tests miss key regressions: alias command crashes, export default format, init force semantics, hook execution portability, and commit-index state safety across failures.","acceptance_criteria":"Automated tests cover query and status aliases, export default invocation, init force behavior, generated hook execution, stale-state backlog scenarios, and failed-index retry semantics.","status":"closed","priority":1,"issue_type":"task","assignee":"Kalle Bylin","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:49.444666+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816182+01:00","closed_at":"2026-02-15T09:45:39.560919+01:00","dependencies":[{"issue_id":"te-0d6.12","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:49.445712+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.13","title":"Implement or remove non-functional search filter flags","description":"The CLI exposes --author, --path, and --since on te search/query, but current behavior does not apply filtering to results. This creates a gap between user expectations and actual behavior in agent workflows that need scoped retrieval.","acceptance_criteria":"1) Either implement --author/--path/--since filtering semantics or remove these flags from search/query. 2) No filter may be silently ignored: unsupported filters must error with clear guidance. 3) CLI help + README must match actual behavior. 4) Regression tests prove both filtered and unfiltered paths and verify no silent-ignore behavior.","notes":"Implemented: Removed non-functional --author, --path, --since flags from te search/query commands. CLI help now accurately reflects available options. Tests updated and passing.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:48:30.302575+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:05:16.773737+01:00","closed_at":"2026-02-15T15:30:00+01:00","dependencies":[{"issue_id":"te-0d6.13","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T11:48:30.304328+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.2","title":"Prevent commit-index state advancement when indexing fails","description":"commit-index updates index_state.json even when commits fail to embed or store, which can permanently skip unindexed commits on later runs.","acceptance_criteria":"State only advances for successfully indexed frontier; failed commits remain retryable; regression test verifies failure then retry indexes skipped commits.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:15.447623+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.81308+01:00","closed_at":"2026-02-15T00:42:13.604651+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.2","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:15.448558+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.3","title":"Make init --force semantics truthful and safe","description":"te init --force currently reports reinitialization but preserves prior indexed data. Implement real reset behavior or adjust UX to be explicitly non-destructive.","acceptance_criteria":"Behavior and messaging are consistent: either data is actually reinitialized or help text explicitly indicates non-destructive operation; tests assert expected document count behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:18.41905+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817992+01:00","closed_at":"2026-02-15T01:11:33.927802+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.3","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:18.419895+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.4","title":"Generate robust post-commit hook command invocation","description":"Generated hooks call bare te and can fail in uv or pyenv environments. Hook command construction should avoid PATH assumptions and handle quoted paths safely.","acceptance_criteria":"Installed hook executes reliably without global PATH assumptions, including data directory paths with spaces; test executes generated hook script in a temp repo.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:21.346811+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817745+01:00","closed_at":"2026-02-15T01:11:33.997381+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.4","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:21.347695+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.5","title":"Fix Town Elder hook detection when command includes extra args","description":"Hook ownership detection checks a brittle te commit-index substring and misclassifies valid Town Elder hooks that include extra args such as --data-dir.","acceptance_criteria":"hook status and hook uninstall correctly recognize Town Elder-managed hooks with and without extra arguments; regression tests cover both forms.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:25.863662+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817504+01:00","closed_at":"2026-02-15T01:11:34.06662+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.5","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:25.864527+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.6","title":"Fix incremental backlog loss when last indexed commit is missing","description":"If last indexed commit is absent from scanned history, incremental mode may index only the first page limit and still advance state, leaving older backlog unindexed.","acceptance_criteria":"When sentinel commit is missing or stale, behavior is deterministic and safe with no silent partial indexing and no unsafe state advance; tests cover backlog larger than limit.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:29.625223+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.817233+01:00","closed_at":"2026-02-15T09:17:17.726496+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.6","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:29.626174+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.7","title":"Make file indexing idempotent by default with stable IDs","description":"Directory indexing currently uses random UUIDs for file documents, so repeated runs duplicate unchanged content and inflate document count.","acceptance_criteria":"Default indexing uses stable document identity and upsert semantics; rerunning index on unchanged files does not increase document count; append behavior is explicit if retained.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:32.385205+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816988+01:00","closed_at":"2026-02-15T09:36:16.387252+01:00","dependencies":[{"issue_id":"te-0d6.7","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:32.386167+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.8","title":"Remove implicit home fallback for default data directory","description":"Current config falls back to a home-level te directory when local te storage is absent, which can cross-contaminate repositories and surprise users.","acceptance_criteria":"Default behavior is repository-local and explicit; no implicit global fallback unless user opts in; documentation and tests updated for the new semantics.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:35.1938+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.816746+01:00","closed_at":"2026-02-15T09:53:25.141265+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.8","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:35.19505+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0d6.9","title":"Eliminate module-global data-dir leakage across CLI invocations","description":"CLI stores selected data directory in module-global state, which leaks across in-process invocations and causes stale configuration behavior in tests and embedded use.","acceptance_criteria":"Data directory resolution is invocation-scoped; repeated in-process calls without data-dir do not inherit stale prior values; regression test added.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T00:20:38.039634+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820569+01:00","closed_at":"2026-02-15T10:27:15.299033+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-0d6.9","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:38.041128+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-0dh","title":"Update stale context docs that still reference Replay paths and commands","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:45.847981+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T23:52:54.003984+01:00","closed_at":"2026-02-15T23:52:54.003984+01:00","close_reason":"Closed"}
{"id":"te-143","title":"Align CLI surface with spec: query/status commands and filters","description":"Implementation exposes search/stats but design docs define query/status and query filters (--since, --author, --path). This creates UX/docs drift.","acceptance_criteria":"Either implement query/status aliases and required filters or formally update specs/docs/tests to declared command contract; help output and README stay consistent.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:23.875406+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821692+01:00","closed_at":"2026-02-14T23:47:26.727539+01:00","close_reason":"Closed"}
{"id":"te-14z","title":"te-git-hook-management","description":"Implement post-commit hook install/uninstall functionality","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.244496+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825086+01:00","closed_at":"2026-02-14T13:57:40.876944+01:00","close_reason":"Git hook management implemented: te hook install/uninstall/status commands working","dependencies":[{"issue_id":"te-14z","depends_on_id":"te-5n1","type":"blocks","created_at":"2026-02-13T21:57:00.658255+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-15d","title":"Rename project to Town Elder, package to town-elder, CLI to te","description":"Rename and rebrand the project from Town Elder to Town Elder.\n\nTarget naming:\n- Product/project name: Town Elder\n- Python distribution/package name: town-elder\n- Python import package: town_elder\n- CLI command: te\n\nThis is a cross-cutting rename touching package layout, entry points, imports, docs, generated hooks, tests, and user-facing output/messages.\n\nScope of required changes:\n1) Packaging and metadata\n- Update pyproject metadata (`[project].name`, description/keywords/classifiers as needed) to `town-elder`.\n- Update console script entry point so `te` is installed and points to the new package.\n- Ensure editable install and wheel/sdist metadata are coherent after rename.\n\n2) Python package/module rename\n- Rename source package from `src/te` to `src/town_elder`.\n- Update all internal imports and module references from `te.*` to `town_elder.*`.\n- Update `__main__` module entrypoints (`python -m town_elder`, `python -m town_elder.cli`) and any old hardcoded module invocations.\n\n3) CLI rename and behavior\n- Ensure CLI branding/help text uses Town Elder terminology.\n- Ensure command examples and output references no longer say `te` unless explicitly documenting compatibility.\n- Update git hook generation/uninstall detection logic so installed hooks invoke the new module/command correctly.\n\n4) Data-dir/config and compatibility strategy\n- Decide and implement compatibility policy for existing `.te` directories/config/state:\n  - either migrate/auto-detect `.te` and move to new location,\n  - or explicitly preserve `.te` for backward compatibility,\n  - or adopt a new default path with clear migration logic.\n- Document this policy clearly.\n\n5) Docs and references\n- Update README and relevant docs/context files to use Town Elder + `te` commands.\n- Update AGENTS/developer docs where command/package names are referenced.\n\n6) Tests and fixtures\n- Update tests that reference old module path/CLI name/output strings.\n- Add/adjust regression tests for:\n  - `uv run te --help`\n  - `python -m town_elder --help`\n  - hook scripts invoking the correct command/module\n  - chosen compatibility behavior for existing `.te` data.\n\n7) Cleanup\n- Remove stale references to old naming in user-facing paths/messages where intended.\n- Keep any intentional compatibility aliases explicitly documented and tested.","acceptance_criteria":"1) `uv run te --help` works and presents Town Elder branding.\n2) `python -m town_elder --help` and `python -m town_elder.cli --help` work.\n3) Distribution metadata identifies package as `town-elder`; imports use `town_elder`.\n4) All runtime imports and tests pass after package rename (no broken `te.*` imports in active code paths).\n5) Hook install/status/uninstall flows generate and detect hook commands for the new CLI/module naming.\n6) A clear migration/compatibility policy for existing `.te` data is implemented and documented.\n7) README and key contributor docs use Town Elder naming and `te` commands.\n8) Full quality gates pass (`uv run pytest`, lint if configured), and no critical rename regressions remain.","notes":"## Implementation Summary\n\n### Changes Made\n\n1. **Package Rename**:  -\u003e \n2. **Python Distribution**: Updated :\n   - Package name:  -\u003e \n   - Console script:  -\u003e \n   - isort known-first-party:  -\u003e \n\n3. **CLI Rebranding**:\n   - CLI name:  -\u003e \n   - All help text and user-facing messages updated\n   - Default data directory:  -\u003e \n\n4. **Import Updates**: All imports changed from  to \n\n5. **Hook Detection Updates**:\n   - Detection function renamed to \n   - Supports both new / hooks and legacy  hooks for backward compatibility\n\n6. **Backward Compatibility**:\n   -  directories are automatically detected and used\n   - Legacy  and  CLI invocations are supported\n   - Hooks generated by old CLI are still detected and managed\n   - zvec collection name kept as  for existing data compatibility\n\n7. **Documentation**:\n   - README updated with new branding and commands\n   - AGENTS.md updated with Town Elder - Semantic memory CLI\nUse --help for usage information command\n\n8. **Tests**: All test files updated to use new imports and commands\n\n### Quality Gates\n- All 65 tests pass\n- Ruff lint checks pass\n\n### Migration Behavior\n- Existing  directories are automatically detected and used\n- Users can continue using old hooks (they're detected as Town Elder hooks)\n- No automatic migration of data - existing  data is read in-place","status":"closed","priority":1,"issue_type":"epic","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:54:02.55356+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814684+01:00","closed_at":"2026-02-15T12:11:25.841941+01:00","close_reason":"Closed"}
{"id":"te-17p","title":"Make generated post-commit hooks work without requiring uv on PATH","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:15.157075+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:12:46.050317+01:00","closed_at":"2026-02-16T00:12:46.050317+01:00","close_reason":"Closed"}
{"id":"te-1cg","title":"Protect non-Town Elder hooks during uninstall","description":"Prevent te hook uninstall from deleting custom post-commit hooks by default.","acceptance_criteria":"1) te hook uninstall refuses to delete non-Town Elder hooks by default with clear message and non-zero exit. 2) --force explicitly allows deletion. 3) Behavior is covered by tests for Town Elder and non-Town Elder hook content.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:21.849963+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814153+01:00","closed_at":"2026-02-14T19:21:20.935716+01:00"}
{"id":"te-1gb","title":"te-setup-project-structure","description":"Create Python package structure with pyproject.toml, directory layout, and base modules","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:22.857833+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.830201+01:00","closed_at":"2026-02-13T22:45:45.366658+01:00"}
{"id":"te-277","title":"Add a --version flag and consistent machine-readable metadata output for CLI","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:31.839932+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:44:56.26972+01:00","closed_at":"2026-02-16T00:44:56.26972+01:00","close_reason":"Closed"}
{"id":"te-27w","title":"commit-index on empty repo prints raw git command error instead of no-commits result","description":"## Summary\nRunning `te commit-index` on an initialized but empty git repository (no commits yet) returns an opaque subprocess error containing raw git command details.\n\n## Reproduction\n1. `git init` a new repo with no commits.\n2. Run `te init`.\n3. Run `te commit-index --limit 10`.\n\nObserved: `Error fetching commits: Command ['git', ... \"log\", ...] returned non-zero exit status 128.`\nExpected: user-friendly output like \"No commits to index\" (exit 0) or a clear structured message without internal command dump.\n\n## Evidence\n`commit_index()` catches all fetch errors and prints `str(e)` from `CalledProcessError`, leaking raw subprocess internals to the CLI.\n\n## Impact\nPoor first-run UX in new repositories and confusing automation logs.","status":"open","priority":3,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:37.14874+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:58:37.14874+01:00"}
{"id":"te-2x2","title":"Consolidate duplicated CLI logic into a clear canonical service layer","description":"## Summary\nThe codebase has service abstractions (`IndexService`, `QueryService`), but core CLI commands implement duplicate indexing/query logic directly. This architectural split increases maintenance cost and risk of behavior drift.\n\n## Why This Matters\n- Business logic spread across CLI and service layer creates inconsistency risk.\n- Bug fixes can land in one path and miss the other.\n- Testing burden increases because behavior is duplicated.\n\n## Current Implementation\nService layer:\n- `src/town_elder/services/index_service.py:13`\n- `src/town_elder/services/query_service.py:9`\n\nCLI duplicates logic instead of using services:\n- `src/town_elder/cli/__init__.py:495` (`index` command)\n- `src/town_elder/cli/__init__.py:604` (`commit_index` command)\n- `src/town_elder/cli/__init__.py:371` (`search`/`query` via helper)\n- `src/town_elder/cli/__init__.py:407` (`add` command)\n\n## Problem Detail\n- `IndexService` and `QueryService` are lightly used or bypassed.\n- CLI performs embedding/store orchestration directly in multiple commands.\n- It is unclear which layer is canonical for core behavior.\n\n## Proposed Change\nChoose and enforce a single architecture direction:\n1. Preferred: make service layer canonical and have CLI delegate to services.\n2. Alternative: remove unused service abstractions if not needed.\n\nIf choosing service-first:\n- Introduce dedicated application services for `add`, `index`, `search`, `commit-index`, `export`, and hook management as appropriate.\n- Keep CLI focused on argument parsing, output formatting, and exit codes.\n\n## Tests To Add/Update\n- Add/adjust unit tests for service methods that now carry canonical logic.\n- Keep CLI integration tests focused on command wiring and UX.\n- Ensure no behavior regression in existing command outputs and error handling.\n\n## Acceptance Criteria\n- Core indexing/query behavior is implemented in one canonical layer.\n- CLI no longer duplicates substantive business logic.\n- Test suite reflects the chosen layering strategy and passes.\n","notes":"Execution order: Phase 4/4 final cleanup. Depends on te-lm6, te-68r, te-zps, te-xe2, and te-4lm.\nRecommended rollout sequence: (1) te-lm6 + te-68r in parallel, (2) te-zps + te-xe2, (3) te-4lm, (4) te-2x2.","status":"closed","priority":3,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:45:25.73865+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T22:28:37.688702+01:00","closed_at":"2026-02-15T22:28:37.688702+01:00","close_reason":"Closed","labels":["phase-4"],"dependencies":[{"issue_id":"te-2x2","depends_on_id":"te-lm6","type":"blocks","created_at":"2026-02-15T17:48:16.494174+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-68r","type":"blocks","created_at":"2026-02-15T17:48:26.817151+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-xe2","type":"blocks","created_at":"2026-02-15T17:48:37.155954+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-zps","type":"blocks","created_at":"2026-02-15T17:48:47.402559+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-2x2","depends_on_id":"te-4lm","type":"blocks","created_at":"2026-02-15T17:48:57.737407+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-3ya","title":"Fix commit-index embedder API regression with injected embedders","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:21.661077+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:46:33.490778+01:00","closed_at":"2026-02-16T02:46:33.490778+01:00","close_reason":"Closed"}
{"id":"te-45a","title":"te-embedder-wrapper","description":"Implement fastembed wrapper with lazy loading, model selection support, and batch embedding capabilities","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:33.660462+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829697+01:00","closed_at":"2026-02-13T22:46:12.055793+01:00","dependencies":[{"issue_id":"te-45a","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:47.278877+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-4g6","title":"Remove tracked bytecode artifacts from repository","description":"Repository currently tracks __pycache__ and .pyc files, causing noisy diffs and nondeterministic churn.","acceptance_criteria":"1) Remove tracked bytecode artifacts from git index. 2) Keep ignore rules preventing reintroduction. 3) Add lightweight guard (test/script/CI check) to block tracked bytecode files.","status":"closed","priority":2,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:25.192363+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822344+01:00","closed_at":"2026-02-14T22:50:01.164768+01:00"}
{"id":"te-4gz","title":"Repair get_config clear_cache behavior","description":"get_config(clear_cache=True) currently raises AttributeError due missing cache decorator.","acceptance_criteria":"1) clear_cache path works without exception. 2) Config caching behavior is explicit and tested.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:13.249847+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823203+01:00","closed_at":"2026-02-14T22:22:14.28835+01:00"}
{"id":"te-4lm","title":"Improve commit-index scalability for long-lived repositories","description":"## Summary\n`commit-index` does not scale well to long-lived repositories (thousands+ commits). The current design performs many per-commit subprocess operations and embeds full diffs, making full-history indexing slow and resource-heavy.\n\n## Why This Matters\nTown Elderâ€™s value proposition includes semantic recall of commit history. For mature repos, current indexing cost can become prohibitive, reducing adoption and trust.\n\n## Current Behavior and Constraints\n- Default limit is 100 commits unless user manually increases it.\n- Incremental sentinel search paginates, but indexing still processes full commit diffs one commit at a time.\n- Many subprocess calls are made per commit.\n\n## Current Implementation Hotspots\nFiles:\n- `src/town_elder/cli/__init__.py:674`\n- `src/town_elder/cli/__init__.py:700`\n- `src/town_elder/cli/__init__.py:746`\n- `src/town_elder/git/runner.py:89`\n- `src/town_elder/git/runner.py:111`\n\nObserved inefficiencies:\n1. `GitRunner.get_commits()` calls `_get_commit_files()` per commit (N+1 git invocations).\n2. `commit-index` calls `git show` per commit for full diff text.\n3. No explicit resumable checkpoint for long full-history runs beyond last indexed frontier semantics.\n\n## Proposed Change\nImplement a scalable indexing path for long histories:\n1. Add explicit CLI controls for depth and batching:\n   - `--all` to index full reachable history.\n   - `--batch-size \u003cn\u003e` for bounded processing chunks.\n2. Reduce subprocess overhead:\n   - Fetch commit metadata in batch-friendly git calls.\n   - Avoid per-commit extra calls where possible.\n3. Add resumable progress checkpoints:\n   - Persist cursor/progress after each batch.\n   - Allow safe resume after interruption.\n4. Bound payload size:\n   - Add safeguards for very large diffs (e.g., truncation policy with metadata markers) so embeddings remain tractable.\n5. Improve user feedback:\n   - Progress output (`indexed X/Y`, current batch, ETA-ish timing where feasible).\n\n## Tests To Add/Update\n- Integration-like test using mocked large commit sets to verify batch/resume behavior.\n- Regression tests ensuring interruption + rerun resumes without duplicate state corruption.\n- Performance-oriented unit tests around reduced git command invocation count (can be mock-based).\n\n## Acceptance Criteria\n- Users can reliably index full history for old repos using `--all` + batching.\n- Interrupted runs can resume without restarting from zero.\n- Command invocation count and runtime characteristics improve relative to current behavior.\n- Existing incremental safety behavior remains intact.\n","notes":"Execution order: Phase 3/4. Depends on te-zps and te-xe2.","status":"closed","priority":2,"issue_type":"feature","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:44:35.762434+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T21:06:43.337321+01:00","closed_at":"2026-02-15T21:06:43.337321+01:00","close_reason":"Closed","labels":["phase-3"],"dependencies":[{"issue_id":"te-4lm","depends_on_id":"te-zps","type":"blocks","created_at":"2026-02-15T17:47:55.830436+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-4lm","depends_on_id":"te-xe2","type":"blocks","created_at":"2026-02-15T17:48:06.159265+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-4vw","title":"IndexService.index_file leaks UnicodeDecodeError instead of IndexingError","description":"IndexService.index_file wraps OSError from read_text but not UnicodeDecodeError. Invalid UTF-8 content therefore escapes as UnicodeDecodeError instead of IndexingError. index_directory only aggregates IndexingError, so one bad-encoding file can bypass error aggregation and abort directory indexing unexpectedly.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.709201+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:52:08.931762+01:00","closed_at":"2026-02-16T03:52:08.931764+01:00"}
{"id":"te-53y","title":"Fix README onboarding accuracy (source clone URL and pip vs uv workflows)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:00.257595+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:36:47.861109+01:00","closed_at":"2026-02-16T00:36:47.861109+01:00","close_reason":"Closed"}
{"id":"te-5a8","title":"Improve filesystem indexing accounting and exclusion controls","description":"index recursively scans all .py/.md files without exclusion (e.g., .venv/.git) and reports attempted count as indexed count even when many files are skipped.","acceptance_criteria":"Add exclusion rules/configuration; report attempted/indexed/skipped accurately; add tests covering unreadable/binary/ignored paths.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:54.741155+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821056+01:00","closed_at":"2026-02-14T23:47:26.715987+01:00","close_reason":"Closed"}
{"id":"te-5n1","title":"te-git-runner","description":"Implement git command execution: get commits, get diffs, commit range","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:43.194978+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825322+01:00","closed_at":"2026-02-13T22:45:51.316719+01:00"}
{"id":"te-66w","title":"Fail fast when embedding backend is unavailable","description":"Do not silently degrade to zero vectors when fastembed cannot be imported.","acceptance_criteria":"1) Missing fastembed raises explicit user-facing error with remediation steps. 2) Any fallback mode is opt-in and clearly indicated. 3) Tests cover missing-backend behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:52.686143+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819427+01:00","closed_at":"2026-02-14T19:27:30.157266+01:00"}
{"id":"te-68r","title":"Make generated git hooks robust to pyenv/uv interpreter resolution","description":"## Summary\nGenerated `post-commit` hooks currently invoke Town Elder with `python -m town_elder ...`. In some common `pyenv`/`uv` environments, `python` is not available on PATH at commit time, causing silent hook failure and missed indexing.\n\n## Why This Matters\n- Automatic commit indexing is a core workflow feature.\n- Hook failures are easy to miss because commits still succeed.\n- Users think history is indexed when it is not.\n\n## Evidence\nObserved during end-to-end hook test:\n- Hook content used:\n  ```sh\n  python -m town_elder --data-dir \"...\" commit-index --repo \"$(git rev-parse --show-toplevel)\"\n  ```\n- Commit-time output included:\n  ```text\n  pyenv: python: command not found\n  ```\n- `index_state.json` was not created after commit (hook did not index).\n\n## Current Implementation\nFiles:\n- `src/town_elder/cli/__init__.py:356`\n- `src/town_elder/cli/__init__.py:358`\n- `src/town_elder/cli/__init__.py:847`\n- `src/town_elder/cli/__init__.py:852`\n\nRelated test signal:\n- `tests/test_cli_regressions.py:442`\n- `tests/test_cli_regressions.py:447`\n\nThe integration test currently rewrites the hook to `uv run te ...`, which indicates default generated hook behavior is not robust in the test/runtime environment.\n\n## Reproduction\n1. Initialize repo and Town Elder with hook installation.\n2. Make a commit.\n3. Observe hook stderr (`python: command not found`) and missing `index_state.json`.\n\n## Proposed Change\nImplement a robust launcher in generated hook scripts. Recommended approach:\n1. Capture installer runtime interpreter path (`sys.executable`) and generate hook using that absolute interpreter:\n   ```sh\n   \"\u003cabsolute-python\u003e\" -m town_elder ...\n   ```\n2. Optionally add fallback logic (`te` command if available) with clear failure output.\n3. Keep path quoting for `--data-dir` and repo path safety.\n4. Ensure behavior is consistent for:\n   - `te init --install-hook`\n   - `te hook install`\n\n## Tests To Add/Update\n- End-to-end hook integration test that uses the generated hook as-is (no rewrite) and verifies commit creates/updates `index_state.json`.\n- Unit/integration tests for hook content generation under explicit `--data-dir` and default data-dir.\n\n## Acceptance Criteria\n- Generated hooks execute successfully in pyenv/uv-managed envs where bare `python` may not exist.\n- A real commit triggers commit indexing and updates `index_state.json`.\n- Hook content generation is covered by regression tests.\n","notes":"Execution order: Phase 1/4. Can be implemented immediately in parallel with te-lm6.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:43:49.834213+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:13:37.648611+01:00","closed_at":"2026-02-15T18:13:37.648611+01:00","close_reason":"Closed","labels":["phase-1"]}
{"id":"te-6g0","title":"Resolve relative gitdir paths in _get_git_dir for submodule hooks","description":"_get_git_dir returns Path(actual_git_dir) verbatim when .git is a file. In submodules, .git commonly stores a relative gitdir like ../../.git/modules/deps/lib. Because the path is not resolved relative to repo_path, hook commands can see exists()==False and report a valid submodule as non-git.","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.704885+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:46:24.261159+01:00"}
{"id":"te-6h0","title":"Add onboarding troubleshooting docs for first-run model download and hook prerequisites","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:16.238443+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:36:45.867391+01:00","closed_at":"2026-02-16T00:36:45.867391+01:00","close_reason":"Closed"}
{"id":"te-6wr","title":"Reduce Ruff lint debt and enforce lint gate in CI","description":"Ruff currently reports complexity and maintainability findings in core CLI and parser paths. Lint debt should be reduced and CI should block regressions.","acceptance_criteria":"Ruff passes for src and tests under project policy; CI executes Ruff as required quality gate.","status":"closed","priority":2,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:25:15.29512+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.820808+01:00","closed_at":"2026-02-15T11:01:51.649724+01:00","dependencies":[{"issue_id":"te-6wr","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:57.926528+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-74s","title":"Eliminate zvec teardown errors in test runs","description":"Pytest passes but emits RocksDB flush/close errors during fixture teardown.","acceptance_criteria":"1) Ensure stores/collections are closed before temp directories are removed. 2) Test fixtures handle lifecycle safely. 3) pytest output is free of teardown error logs for this path.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:35.470828+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822123+01:00","closed_at":"2026-02-14T22:12:05.329223+01:00"}
{"id":"te-78q","title":"te-domain-exceptions","description":"Define custom exception types: Town ElderError, DatabaseError, EmbeddingError, ConfigError","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:42.914373+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825788+01:00","closed_at":"2026-02-13T22:46:12.0943+01:00","dependencies":[{"issue_id":"te-78q","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:57:44.372351+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-7lt","title":"Implement true incremental commit indexing","description":"Current hook path reindexes recent history each commit; add durable state so only new commits are indexed.","acceptance_criteria":"1) commit-index defaults to indexing only commits after last indexed marker. 2) post-commit hook uses incremental path. 3) Re-running commit-index without new commits performs no duplicate writes. 4) Tests cover idempotency and state updates.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:32.141856+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819879+01:00","closed_at":"2026-02-14T19:32:12.366004+01:00"}
{"id":"te-7r2","title":"Make hook execution integration test assert real side effects","description":"Current hook execution test monkeypatches in-process functions but hook execution occurs in a separate process, so the assertion does not verify real behavior. Replace with a true integration assertion based on durable side effects.","acceptance_criteria":"1) Test verifies actual hook-triggered indexing side effect (e.g. state file/document count), not monkeypatched call count. 2) Test fails if hook command is broken. 3) Remove misleading no-op verification comments.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:30.760168+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:41:10.289511+01:00","closed_at":"2026-02-15T15:41:10.289511+01:00","close_reason":"Closed"}
{"id":"te-84k","title":"Harden CLI integration test setup subprocess checks","description":"Many integration tests run git or CLI subprocesses during setup without check=True or explicit return-code assertions. Failures can be silently ignored and produce false positives or delayed confusing failures.","acceptance_criteria":"1) Setup subprocess calls are checked via check=True or explicit return-code assertions. 2) Setup failures surface immediately with useful diagnostics. 3) CI behavior remains stable.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.139916+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:56:53.579768+01:00","closed_at":"2026-02-15T16:30:00+01:00"}
{"id":"te-8na","title":"Correct CLI stdout vs stderr stream usage","description":"Normal command output should go to stdout; error output should go to stderr.","acceptance_criteria":"1) Success paths write human-readable output to stdout. 2) Error paths write to stderr and set proper exit codes. 3) Stream behavior is covered by CLI tests.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:44.079818+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822783+01:00","closed_at":"2026-02-14T22:19:35.297639+01:00"}
{"id":"te-8td","title":"README: remove or implement nonexistent --no-uv hook option","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:52.739401+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:57:43.722817+01:00"}
{"id":"te-9aq","title":"Tighten init --force safe-path checks to prevent deleting arbitrary hidden directories","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:32.417767+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.812608+01:00","closed_at":"2026-02-16T02:02:16.812608+01:00","close_reason":"Closed"}
{"id":"te-9er","title":"te-vector-store-wrapper","description":"Implement zvec wrapper with insert, search, and delete operations for vector storage","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:36.839185+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.82941+01:00","closed_at":"2026-02-13T22:46:12.068827+01:00","dependencies":[{"issue_id":"te-9er","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:51.841469+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-9h0","title":"te-cli-init-command","description":"Implement 'te init' command to initialize database storage in specified directory","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:40.505593+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829155+01:00","closed_at":"2026-02-14T13:58:04.258201+01:00","close_reason":"init command already implemented and working","dependencies":[{"issue_id":"te-9h0","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:53:56.196227+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-9h0","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.213053+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-9h1","title":"Align CLI and storage invariants with canonical context","description":"Reconcile command names and storage path invariants with canonical architecture/context while keeping README onboarding coherent.","acceptance_criteria":"1) Decide and document canonical invariants for command surface (query/status vs aliases) and storage location (.git/te vs .te). 2) Implement chosen behavior or compatibility aliases. 3) Update README and canonical docs consistently.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:04.634379+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818999+01:00","closed_at":"2026-02-14T19:08:09.670004+01:00","close_reason":"Closed"}
{"id":"te-9kq","title":"Fix init path and data directory consistency","description":"Commands should operate predictably when te is initialized outside current working directory.","acceptance_criteria":"1) After te init --path X, users can run follow-up commands against X without changing directory (via persisted config or explicit flags). 2) add/search/index/stats share consistent path semantics. 3) Docs reflect the chosen behavior.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:59:42.421172+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819648+01:00","closed_at":"2026-02-14T21:38:51.83142+01:00"}
{"id":"te-9oe","title":"Report accurate indexing success and skip counts","description":"Index commands currently report attempted totals as successful totals.","acceptance_criteria":"1) index and commit-index output attempted/succeeded/skipped counts. 2) Final success count equals inserted documents. 3) Tests verify behavior with unreadable files and skipped commits.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:02.973554+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823404+01:00","closed_at":"2026-02-14T19:33:31.336298+01:00"}
{"id":"te-9s6","title":"commit-index --all is ignored when incremental state exists","description":"## Summary\nWhen `te commit-index --all` is run in a repo that already has `index_state.json`, the command does not traverse full history. It stops at the incremental sentinel and indexes nothing older than the current cursor.\n\n## Reproduction\n1. Create a git repo with 10 commits.\n2. Run `te init`.\n3. Run `te commit-index --limit 3` (indexes only newest 3, writes state cursor).\n4. Run `te commit-index --all`.\n5. Count indexed docs via `te export --output - --format json`.\n\nObserved: count stays at 3.\nExpected: count should grow to include full commit history (10 in this repro), or `--all` should explicitly disable incremental cursor behavior.\n\n## Evidence\nIn `src/town_elder/cli/__init__.py`, the incremental branch (`if incremental and last_indexed and not force`) runs before the `elif all_history` branch, so `--all` is effectively bypassed when a sentinel exists.\n\n## Impact\nUsers cannot backfill older history after initial limited indexing unless they discover and use a non-obvious flag combination (`--full`/`--force`), which contradicts `--all` semantics.","status":"in_progress","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:19.530024+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T04:01:50.416546+01:00"}
{"id":"te-a31","title":"te-cli-entry-point","description":"Create main CLI entry point with typer and command registration","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:57.249237+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824048+01:00","closed_at":"2026-02-14T13:57:23.123382+01:00","close_reason":"CLI entry point implemented with typer: init, add, search, stats, index, commit-index, hook commands all working","dependencies":[{"issue_id":"te-a31","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:57:30.212185+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-aaq","title":"Add Ruff linting to te project","description":"Add Ruff as a dev dependency, configure lint rules in pyproject.toml, add a lint command to contributor docs, and include Ruff in CI quality gates.","acceptance_criteria":"1)  runs successfully in dev setup. 2) pyproject includes Ruff configuration with at least baseline rule set and excludes. 3) README/AGENTS docs mention lint command. 4) CI runs Ruff and fails on lint violations.","notes":"Duplicate of te-rtr which already added Ruff linting","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:43:57.197944+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823831+01:00","closed_at":"2026-02-14T22:57:28.257755+01:00"}
{"id":"te-awt","title":"Guard commit-index batch embedding alignment (zip strict) to prevent silent commit drops","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T02:12:42.376745+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:56:38.917968+01:00","closed_at":"2026-02-16T02:56:38.917968+01:00","close_reason":"Closed"}
{"id":"te-ax2","title":"commit-index --full fails to advance index state after duplicate commit skips","description":"commit_index uses store.insert for commit docs and sets frontier_blocked=True on first insert failure. In --full mode against an already indexed store, older duplicate commits fail first; newer commits may still insert, but frontier_commit_hash no longer advances, so index_state.json is never updated and later incremental runs reprocess the same commits.","status":"completed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:40:01.708972+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:51:44.974832+01:00"}
{"id":"te-ayj","title":"te-setup-uv-and-pyenv","description":"Set up uv and pyenv in this project so we can easily run everything with uv. This will allow us to easily manage dependencies and virtual environments.","status":"closed","priority":0,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T09:07:34.533483+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.814397+01:00","closed_at":"2026-02-14T13:57:19.314696+01:00","close_reason":"Project setup completed: pyproject.toml, dependencies, .python-version all configured"}
{"id":"te-b0j","title":"Fix IndexService index_file doc_id to satisfy zvec ID regex","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:28.624822+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:18:19.386471+01:00","closed_at":"2026-02-16T07:45:00+01:00"}
{"id":"te-b19","title":"Add CLI integration tests for critical behaviors","description":"Current tests miss key CLI workflows and safety behaviors discovered in review.","acceptance_criteria":"1) Add integration tests for path semantics, hook uninstall safety, incremental indexing, metadata validation, stream routing, and exit codes. 2) Tests run in temp git repos and assert observable CLI behavior.","status":"closed","priority":1,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:01:14.926596+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818781+01:00","closed_at":"2026-02-14T21:55:50.041339+01:00"}
{"id":"te-blu","title":"Optimize te index file discovery to avoid full-list materialization on large repos","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:35:47.088656+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:45:10.30409+01:00"}
{"id":"te-c24","title":"_is_te_hook matches comment text and can delete non-TE hooks without --force","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:17.343852+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:21:35.767529+01:00"}
{"id":"te-c9n","title":"Honor configured embed_model in IndexService and QueryService default embedder construction","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:36.627429+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:40:44.512856+01:00","closed_at":"2026-02-16T02:00:00+01:00"}
{"id":"te-cbh","title":"Add CLI regression tests for top-k validation and non-text hook files","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:29.892624+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T00:12:48.784882+01:00","closed_at":"2026-02-16T00:12:48.784882+01:00","close_reason":"Closed"}
{"id":"te-chc","title":"te-cli-export-command","description":"Implement 'te export' command to export indexed data","notes":"Implemented 'te export' command to export indexed data to JSON or JSONL format. Added get_all method to ZvecStore and export command to CLI with options for output file, format (json/jsonl), and include-vectors flag.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:09.486592+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826509+01:00","closed_at":"2026-02-14T23:04:46.947915+01:00","dependencies":[{"issue_id":"te-chc","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:17.547702+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-chc","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.626135+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-cib","title":"Return real similarity scores from vector search","description":"Search currently returns hardcoded score 1.0 for all results.","acceptance_criteria":"1) Store returns actual similarity or distance-derived score from backend. 2) CLI shows meaningful ranked scores. 3) Tests validate non-constant score behavior.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:23.511601+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823002+01:00","closed_at":"2026-02-14T22:14:01.338528+01:00"}
{"id":"te-cye","title":"Do not silently recreate zvec collection on open failures","description":"ZvecStore catches all open errors and falls back to creating a new collection, masking corruption/schema/permission issues and risking silent data fork/loss.","acceptance_criteria":"Differentiate missing collection vs fatal open errors; fail fast on corruption/schema mismatch with actionable message; add tests proving no implicit create on non-not-found failures.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:13.577309+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813667+01:00","closed_at":"2026-02-14T23:33:32.62211+01:00","close_reason":"Closed"}
{"id":"te-czr","title":"Update README options/docs to match CLI reality (index path arg, no config.json artifact)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:38.748022+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.810093+01:00","closed_at":"2026-02-16T02:02:16.810093+01:00","close_reason":"Closed"}
{"id":"te-d4w","title":"Write index_state.json atomically to avoid state corruption on interrupted writes","status":"in_progress","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:46.56733+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:46:03.646433+01:00"}
{"id":"te-ddj","title":"Validate metadata type for te add","description":"te add accepts JSON that is not an object and fails later with internal error.","acceptance_criteria":"1) Non-object JSON metadata is rejected as invalid argument with clear message. 2) Exit code matches invalid usage. 3) Tests cover list/string metadata rejection.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:54.355685+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.822552+01:00","closed_at":"2026-02-14T22:21:14.779588+01:00"}
{"id":"te-df9","title":"te-domain-entities","description":"Define domain entities: Document, Chunk, Commit, SearchResult","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:33.81205+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826014+01:00","closed_at":"2026-02-13T22:46:12.081599+01:00","dependencies":[{"issue_id":"te-df9","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:57:44.264984+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-don","title":"Reconcile init behavior with hook installation expectations","description":"Design expects init to include hook setup flow, but current implementation only initializes storage. Users can believe auto-indexing is enabled when it is not.","acceptance_criteria":"Define and implement explicit init behavior (auto-install hook or clear opt-in messaging/flag); include integration test and docs update.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:34.170636+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821476+01:00","closed_at":"2026-02-14T23:47:26.724354+01:00","close_reason":"Closed"}
{"id":"te-emf","title":"Stop swallowing vector store operational errors","description":"Vector store methods currently suppress exceptions and hide failures.","acceptance_criteria":"1) get/delete/count/search wrap backend failures in typed errors instead of silent pass. 2) CLI surfaces actionable error messages. 3) Tests cover failure propagation.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:00:33.792933+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.819214+01:00","closed_at":"2026-02-14T19:28:55.950036+01:00"}
{"id":"te-epe","title":"Add integration tests for hook launcher portability (uv absent, te/python fallback)","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:36:20.786763+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:10:30.852942+01:00","closed_at":"2026-02-16T01:10:30.852942+01:00","close_reason":"Closed"}
{"id":"te-fnp","title":"Propagate --data-dir into installed post-commit hook","description":"The generated hook script hardcodes 'te commit-index --repo ...' and drops any configured --data-dir, causing auto-indexing to write into the wrong store for repos initialized with a custom data directory.","acceptance_criteria":"Hook install writes a script that preserves configured data dir; commits index into the same store used by init/add/search; add regression test for custom data-dir hook flow.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:03.265964+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.813912+01:00","closed_at":"2026-02-14T23:33:32.487309+01:00","close_reason":"Closed"}
{"id":"te-gyg","title":"hook install crashes in git worktrees where .git is a file","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:06.976727+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:12:40.528976+01:00"}
{"id":"te-h32","title":"commit-index crashes when index_state.json has non-dict repos payload","description":"## Summary\n`te commit-index` crashes with an unhandled `AttributeError` if `index_state.json` contains `{\"repos\": \u003cnon-dict\u003e}` (for example a string).\n\n## Reproduction\n1. Initialize repo and run `te init`.\n2. Write malformed-but-valid JSON to `.town_elder/index_state.json`, e.g. `{\"repos\":\"oops\"}`.\n3. Run `te commit-index --limit 1`.\n\nObserved: command exits with traceback ending in `AttributeError: \"str\" object has no attribute \"get\"`.\nExpected: command should treat malformed state as empty/recoverable and continue safely (or emit a friendly validation error without traceback).\n\n## Evidence\n`_load_index_state()` in `src/town_elder/cli/__init__.py` assumes `state[\"repos\"]` is a dict and calls `.get(...)` without type-checking, unlike `_save_index_state()` which already guards against non-dict `repos`.\n\n## Impact\nCorrupted or manually edited state files can hard-crash commit indexing, breaking automation and hooks.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:26.074306+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T04:10:56.129383+01:00","closed_at":"2026-02-16T04:10:56.129383+01:00","close_reason":"Fixed in bb52f8a - added type check in _load_index_state()"}
{"id":"te-hxw","title":"Preserve raw content when exporting JSON to stdout","description":"Export to stdout currently goes through Rich console print, which can interpret bracket markup and mutate payload content. Export output must be byte-accurate JSON or JSONL.","acceptance_criteria":"1) export --output - emits raw JSON/JSONL bytes without Rich markup interpretation. 2) Payloads containing bracket-style text (e.g. [brackets], [bold]x[/bold]) round-trip unchanged. 3) Regression tests validate stdout parsing and exact content preservation for markup-like strings.","notes":"BDD review (2026-02-15) repro: add text 'contains [brackets] and [bold]tags[/bold]', then te export --output - --format json. Current output mutates text to 'contains  and tags'.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.257971+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:30:43.039463+01:00","closed_at":"2026-02-15T15:30:43.039463+01:00","close_reason":"Closed"}
{"id":"te-iqw","title":"Fix incremental commit indexing backlog loss when pending \u003e limit","description":"commit-index uses limited history and updates last_indexed marker in a way that can strand older unindexed commits if new commits exceed --limit between runs.","acceptance_criteria":"Indexing guarantees no commit gaps across runs; state advancement is correct under high commit velocity; add regression test with synthetic history \u003e limit.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:24:44.469209+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821266+01:00","closed_at":"2026-02-14T23:47:26.720633+01:00","close_reason":"Closed"}
{"id":"te-j50","title":"Eliminate get_config cache leakage across in-process CLI invocations","description":"get_config is cached while default resolution depends on current working directory. In-process multi-invocation use can return stale cwd-derived configuration and violate invocation scoping.","acceptance_criteria":"1) Config resolution is invocation-safe within a process. 2) Repeated calls across different cwd values do not return stale paths. 3) Add deterministic regression test that covers at least three cwd transitions.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.146862+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T15:49:11.108035+01:00","closed_at":"2026-02-15T15:49:11.108039+01:00"}
{"id":"te-ld0","title":"te-service-factory","description":"Create service factory for dependency injection and port implementations","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:57.104565+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824334+01:00","closed_at":"2026-02-14T13:57:28.098646+01:00","close_reason":"Service factory implemented: create_embedder, create_vector_store, create_git_runner, create_diff_parser all working","dependencies":[{"issue_id":"te-ld0","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:57:08.28687+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ld0","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:08.416662+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ld0","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:08.516925+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-lm6","title":"Fix dangerous -h short option collision in te init","description":"## Summary\n`te init` currently binds `-h` to `--install-hook`, which conflicts with the universal CLI expectation that `-h` means help. This can trigger side effects (database initialization and hook installation attempt) when a user only wanted help.\n\n## Why This Matters\nThis is a high-risk UX/safety issue:\n- Users accustomed to `-h` can accidentally mutate project state.\n- Running `te init -h` can create `.town_elder` and attempt hook changes.\n- It violates standard Typer/Click-style command behavior and principle of least surprise.\n\n## Evidence\nCommand run:\n```bash\nuv run te init -h\n```\nObserved behavior:\n- Command initialized a database instead of printing help.\n- Output included initialization success text and hook-related warning.\n\n## Current Implementation\nFile:\n- `src/town_elder/cli/__init__.py:265`\n- `src/town_elder/cli/__init__.py:268`\n\nRelevant option definition:\n- `install_hook` is defined as `--install-hook` with short flag `-h`.\n\n## Expected Behavior\n- `te init -h` should show command help and exit successfully without side effects.\n- `--install-hook` should still be available for explicit hook installation.\n\n## Proposed Change\n1. Remove `-h` alias from `--install-hook`.\n2. Keep `--install-hook` long form only, or reassign a non-conflicting short option (e.g., `-i`).\n3. Ensure standard help behavior is restored for `te init -h` and `te init --help`.\n4. Update any docs/help text that references short flag usage.\n\n## Tests To Add/Update\n- CLI integration test asserting `te init -h` prints usage/help and does **not** initialize storage.\n- CLI test asserting `te init --install-hook` still installs hook when requested.\n\n## Acceptance Criteria\n- `te init -h` displays help and exits `0`.\n- No `.town_elder` directory is created when running help.\n- `te init --install-hook` remains functional.\n- Tests cover regression.\n","notes":"Execution order: Phase 1/4. Can be implemented immediately in parallel with te-68r.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:43:23.678197+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:13:37.570473+01:00","closed_at":"2026-02-15T18:13:37.570473+01:00","close_reason":"Closed","labels":["phase-1"]}
{"id":"te-nae","title":"Validate search/query --top-k and reject zero/negative values","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:33:44.385303+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T22:56:21.342299+01:00","closed_at":"2026-02-15T22:56:21.342299+01:00","close_reason":"Fixed in commit 3028939"}
{"id":"te-nch","title":"hook install succeeds with explicit --data-dir even when DB is not initialized","description":"## Summary\n`te hook install` accepts an explicit `--data-dir` path that does not exist and still installs the post-commit hook.\n\n## Reproduction\n1. Create a git repo with no Town Elder initialization.\n2. Run `te --data-dir /tmp/nonexistent hook install --repo \u003crepo\u003e`.\n\nObserved: exit code 0, hook is installed.\nExpected: command should fail with a friendly \"Database not initialized\" message (consistent with other commands and docs that require running `te init` first).\n\n## Evidence\nIn `src/town_elder/cli/__init__.py`, `hook install` calls `get_config(data_dir=data_dir)` but does not validate `config.data_dir.exists()`. Passing explicit `--data-dir` bypasses default-path `ConfigError` checks.\n\n## Impact\nHooks are installed in a broken state and fail later at commit time, creating delayed and confusing failures for users.","status":"open","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:58:31.64778+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:58:31.64778+01:00"}
{"id":"te-o39","title":"hook uninstall exits 0 for non-git paths instead of reporting invalid repo","status":"in_progress","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-16T03:08:27.703698+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T03:26:40.072708+01:00"}
{"id":"te-oc7","title":"te-cli-add-command","description":"Implement 'te add' command to add documents to the vector store","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:44.189478+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828886+01:00","closed_at":"2026-02-14T13:58:08.620112+01:00","close_reason":"add command already implemented and working","dependencies":[{"issue_id":"te-oc7","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:00.055969+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-oc7","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:00.162288+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-oc7","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.321436+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-ohd","title":"Increase coverage of high-risk CLI and git runner paths","description":"Coverage is weak in high-risk orchestration code, especially CLI command flows and git runner failure paths. Add focused tests for error handling and subprocess edge cases.","acceptance_criteria":"1) Add tests for critical untested branches in CLI and git runner code. 2) Validate exit codes and user-facing errors on failure paths. 3) Increase confidence for release-critical behavior.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.146869+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:13:28.606566+01:00","closed_at":"2026-02-15T16:13:28.606566+01:00","close_reason":"Closed"}
{"id":"te-oua","title":"Expand _is_te_hook detection to support python3/python3.x interpreter names","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:44:34.512704+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T02:02:16.811368+01:00","closed_at":"2026-02-16T02:02:16.811368+01:00","close_reason":"Closed"}
{"id":"te-pam","title":"te-git-diff-parser","description":"Implement git diff parsing to extract file changes from commits","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:43.054771+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.825549+01:00","closed_at":"2026-02-13T22:46:12.107607+01:00","dependencies":[{"issue_id":"te-pam","depends_on_id":"te-5n1","type":"blocks","created_at":"2026-02-13T21:56:54.151768+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-qi6","title":"Handle missing .te config paths without Python traceback","description":"Commands such as stats, search, hook install, and export can raise ConfigError before command-level handling when run outside initialized directories. This currently leaks Python tracebacks instead of actionable CLI errors.","acceptance_criteria":"1) In a directory without .te and without --data-dir, user-facing commands fail with friendly CLI errors (no traceback) and non-zero exit code. 2) Coverage includes at least stats, status, search/query, and export. 3) Error output clearly instructs to run te init or pass --data-dir. 4) Regression tests assert traceback absence and stable behavior.","notes":"BDD review (2026-02-15): reproduced traceback leakage with: (a) cd \u003cfresh-dir\u003e \u0026\u0026 uv run --project /Users/bylin/Code/te te stats, and (b) cd \u003cfresh-dir\u003e \u0026\u0026 uv run --project /Users/bylin/Code/te te search 'test'. Both currently raise ConfigError traceback before command-level handling.","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:35.815433+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T14:54:58.004005+01:00","closed_at":"2026-02-15T14:54:58.004007+01:00"}
{"id":"te-qnf","title":"Fix export default format selection and stdout behavior","description":"Export fails with default options because format remains unset when output is stdout. Default invocation should produce valid JSON output without requiring --format.","acceptance_criteria":"te export with defaults succeeds and emits valid JSON; explicit json and jsonl modes continue to work; regression test added.","status":"closed","priority":1,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T23:25:05.0061+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.818527+01:00","closed_at":"2026-02-15T01:11:33.85136+01:00","close_reason":"Closed","dependencies":[{"issue_id":"te-qnf","depends_on_id":"te-0d6","type":"parent-child","created_at":"2026-02-15T00:20:57.926337+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-qr4","title":"te-query-service","description":"Implement application service for semantic search queries","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.528362+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824585+01:00","closed_at":"2026-02-14T13:58:14.00734+01:00","close_reason":"Query service implemented via te search command","dependencies":[{"issue_id":"te-qr4","depends_on_id":"te-ld0","type":"blocks","created_at":"2026-02-13T21:57:23.956958+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-qr4","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:24.065601+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-qr4","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:24.166868+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-r6x","title":"te-cli-search-command","description":"Implement 'te search' command for semantic search over indexed documents","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:55.878327+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828551+01:00","closed_at":"2026-02-14T13:58:08.724461+01:00","close_reason":"search command already implemented and working","dependencies":[{"issue_id":"te-r6x","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:13.711155+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-r6x","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:13.837459+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-r6x","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.421661+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-rhg","title":"Update README with explicit uv CLI run commands","description":"Clarify README usage so contributors can run the CLI reliably with uv in both local repo and external target-repo workflows.","acceptance_criteria":"1) README includes clear examples for `uv run te ...` from project root. 2) README includes `uv run --project /path/to/te te ...` example for operating on another repository. 3) Quick Start and command examples are internally consistent. 4) Any outdated invocation examples are removed.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T19:08:04.624385+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.821907+01:00","closed_at":"2026-02-14T22:24:43.058156+01:00"}
{"id":"te-rtr","title":"Add Ruff linting to te project","description":"Add Ruff as a dev dependency, configure lint rules in pyproject.toml, add a lint command to contributor docs, and include Ruff in CI quality gates.","acceptance_criteria":"1) uv run ruff check src tests runs successfully in dev setup. 2) pyproject includes Ruff configuration with at least baseline rule set and excludes. 3) README/AGENTS docs mention lint command. 4) CI runs Ruff and fails on lint violations.","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-14T18:44:13.420764+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.823611+01:00","closed_at":"2026-02-14T22:43:41.953974+01:00"}
{"id":"te-s27","title":"Batch embedding generation in commit-index to reduce indexing latency","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:36:03.773751+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-16T01:04:08.270723+01:00","closed_at":"2026-02-16T01:04:08.270723+01:00","close_reason":"Closed"}
{"id":"te-ute","title":"te-cli-stats-command","description":"Implement 'te stats' command to show indexing statistics and storage info","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:05.103778+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.828204+01:00","closed_at":"2026-02-14T13:58:08.831627+01:00","close_reason":"stats command already implemented and working","dependencies":[{"issue_id":"te-ute","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:17.406896+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-ute","depends_on_id":"te-a31","type":"blocks","created_at":"2026-02-13T21:57:37.520377+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-vay","title":"Handle non-UTF8 git hook files without crashing hook install/status/uninstall","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T22:34:00.838454+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T23:06:54.516167+01:00","closed_at":"2026-02-15T23:06:54.516167+01:00","close_reason":"Closed"}
{"id":"te-vdd","title":"te-index-service","description":"Implement application service for indexing documents with embeddings","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:54:50.39034+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.824835+01:00","closed_at":"2026-02-14T13:58:13.893166+01:00","close_reason":"Index service implemented via te index and commit-index commands","dependencies":[{"issue_id":"te-vdd","depends_on_id":"te-ld0","type":"blocks","created_at":"2026-02-13T21:57:15.565831+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:57:15.676187+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:57:15.778841+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-vdd","depends_on_id":"te-pam","type":"blocks","created_at":"2026-02-13T21:57:15.879123+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-vut","title":"te-config-management","description":"Implement configuration management with pydantic-settings, environment variable support, and config file loading","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:52:27.086572+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.829953+01:00","closed_at":"2026-02-13T22:46:12.043096+01:00","dependencies":[{"issue_id":"te-vut","depends_on_id":"te-1gb","type":"blocks","created_at":"2026-02-13T21:53:38.848645+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-xe2","title":"Scope commit-index incremental state by repository","description":"## Summary\n`commit-index` stores incremental cursor state as a single global `last_indexed_commit` in one `index_state.json` per data-dir. This is incorrect when one data-dir is reused across multiple repositories.\n\n## Why This Matters\n- Multi-repo workflows are explicitly supported via `--data-dir` and `--repo`.\n- Global cursor causes cross-repo interference.\n- A commit hash from repo A is not meaningful in repo B, so repo B repeatedly enters \"sentinel not found\" behavior.\n\n## Evidence\nBehavior observed with two different repos sharing one data-dir:\n1. Index repo A -\u003e state written with repo A hash.\n2. Index repo B -\u003e warning repeats:\n   - `Warning: Last indexed commit not found in history.`\n   - `Indexing all available commits without advancing state.`\n3. State remains pinned to repo A hash, so repo B never gets a stable incremental cursor.\n\n## Current Implementation\nFiles:\n- `src/town_elder/cli/__init__.py:652`\n- `src/town_elder/cli/__init__.py:658`\n- `src/town_elder/cli/__init__.py:779`\n- `src/town_elder/cli/__init__.py:782`\n\nCurrent state format:\n```json\n{\"last_indexed_commit\": \"\u003chash\u003e\"}\n```\nNo repo keying is present.\n\n## Proposed Change\n1. Make incremental state repo-scoped.\n2. Use a deterministic repo identifier (e.g., hash of canonical git top-level path, optionally include remote URL when available).\n3. Store state structure like:\n   ```json\n   {\n     \"repos\": {\n       \"\u003crepo-id\u003e\": {\n         \"last_indexed_commit\": \"\u003chash\u003e\",\n         \"repo_path\": \"\u003ccanonical-path\u003e\",\n         \"updated_at\": \"\u003ciso8601\u003e\"\n       }\n     }\n   }\n   ```\n4. Add backward-compatible migration logic:\n   - If legacy global key exists, map it to current repo once, then persist new schema.\n5. Ensure stale/missing sentinel handling remains safe per repo.\n\n## Tests To Add/Update\n- New regression test: two repos sharing same data-dir maintain independent cursors and do not cross-trigger sentinel warnings.\n- Migration test from legacy schema to repo-scoped schema.\n- Existing commit-index state safety tests should continue passing.\n\n## Acceptance Criteria\n- Incremental indexing state is isolated by repo.\n- Re-indexing repo B after repo A does not reuse repo A cursor.\n- `index_state.json` schema supports multiple repos and migration from legacy single-key format.\n","notes":"Execution order: Phase 2/4 prerequisite. Complete before te-4lm because scalable indexing needs repo-scoped state.","status":"closed","priority":1,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:44:12.293585+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T18:16:12.726009+01:00","closed_at":"2026-02-15T18:16:12.726009+01:00","close_reason":"Closed","labels":["phase-2"]}
{"id":"te-xhb","title":"Align embedding fallback error messaging with actual CLI capabilities","description":"Embedder error text references a fallback CLI flag that does not exist. Either implement the flag end to end or correct the message so users are not misled.","acceptance_criteria":"1) Error messaging reflects real CLI capabilities. 2) If fallback is supported, add CLI option and docs; otherwise remove the flag reference. 3) Add or update tests accordingly.","status":"closed","priority":3,"issue_type":"chore","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.153641+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T16:20:56.616793+01:00","closed_at":"2026-02-15T16:20:56.616793+01:00","close_reason":"fixed"}
{"id":"te-zda","title":"Guard te init --force from deleting arbitrary directories","description":"te init --force currently deletes data_dir recursively without constraining the target to te-managed storage. If users pass an unsafe --data-dir, unrelated files can be removed. Add path safety checks and fail closed.","acceptance_criteria":"1) te init --force refuses unsafe --data-dir targets that are not clearly te-managed storage. 2) It must fail closed for broad paths (e.g. repo root/home/other non-te dirs) and explain why. 3) Deletion is permitted only for validated te storage targets. 4) Regression tests cover safe and unsafe targets and verify no unrelated files are deleted.","notes":"BDD review (2026-02-15): confirmed destructive behavior. Repro: initialize with --data-dir \u003ctmp\u003e/unsafe-dir, create \u003ctmp\u003e/unsafe-dir/subdir/marker.txt, rerun te init --force with same --data-dir. marker.txt is deleted (observed output: MARKER_DELETED).","status":"closed","priority":0,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T11:19:31.186099+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T14:35:28.131034+01:00","closed_at":"2026-02-15T14:35:28.131036+01:00"}
{"id":"te-zph","title":"te-test-infrastructure","description":"Set up pytest, test directory structure, and basic unit tests for core components","status":"closed","priority":2,"issue_type":"task","owner":"kallebylin@hotmail.com","created_at":"2026-02-13T21:53:28.936164+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T12:43:15.826257+01:00","closed_at":"2026-02-14T14:30:26.926211+01:00","close_reason":"Test infrastructure set up with pytest, conftest.py, and 20/21 tests passing. Tests cover embedder, vector store, and diff parser.","dependencies":[{"issue_id":"te-zph","depends_on_id":"te-vut","type":"blocks","created_at":"2026-02-13T21:54:21.122086+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-zph","depends_on_id":"te-45a","type":"blocks","created_at":"2026-02-13T21:54:21.229713+01:00","created_by":"Kalle Bylin"},{"issue_id":"te-zph","depends_on_id":"te-9er","type":"blocks","created_at":"2026-02-13T21:54:21.340292+01:00","created_by":"Kalle Bylin"}]}
{"id":"te-zps","title":"Harden GitRunner commit parsing against delimiter collisions","description":"## Summary\nGit commit parsing currently depends on splitting `git log` lines by a literal delimiter (`|||`). Commit subjects can legally contain this delimiter, causing incorrect field parsing and potentially malformed indexing metadata.\n\n## Why This Matters\n- Parsing bugs in commit metadata can silently degrade history indexing quality.\n- Incorrect hash/message/author/date extraction can break search relevance and debugging trust.\n\n## Current Implementation\nFiles:\n- `src/town_elder/git/runner.py:66`\n- `src/town_elder/git/runner.py:78`\n\nCurrent format/parsing approach:\n- Uses `--format=%H|||%s|||%an|||%ad|||%f`\n- Splits line with `.split(\"|||\")`\n\nThis is not robust to delimiter collision in commit subject `%s`.\n\n## Reproduction Scenario\n1. Create a commit with subject containing `|||`, e.g.:\n   ```bash\n   git commit -m \"fix parser ||| edge case\"\n   ```\n2. Run `commit-index` or `GitRunner.get_commits()`.\n3. Observe malformed parsed fields or inconsistent commit metadata.\n\n## Proposed Change\nReplace ad-hoc delimiter parsing with robust record/field separators:\n1. Use null-safe separators in git format output (e.g., `%x1f` field separator and `%x1e` record separator, or `-z`-based strategy).\n2. Parse by explicit control characters rather than human text delimiters.\n3. Prefer ISO-8601 strict datetime (`%aI`) for reliable parsing.\n4. Keep backward-compatible behavior for existing callers.\n\n## Tests To Add/Update\n- New unit test where commit subject contains `|||`.\n- Additional test with unusual punctuation/Unicode in commit subject.\n- Ensure parsed `Commit` objects still populate hash/message/author/date/files correctly.\n\n## Acceptance Criteria\n- Commits with delimiter-like text in subject parse correctly.\n- `GitRunner.get_commits()` is robust to arbitrary subject content.\n- Regression tests cover delimiter collision cases.\n","notes":"Execution order: Phase 2/4 prerequisite. Complete before te-4lm to avoid refactoring parser twice.","status":"closed","priority":2,"issue_type":"bug","owner":"kallebylin@hotmail.com","created_at":"2026-02-15T17:45:02.655265+01:00","created_by":"Kalle Bylin","updated_at":"2026-02-15T20:10:15.053904+01:00","closed_at":"2026-02-15T20:10:15.053904+01:00","close_reason":"Closed","labels":["phase-2"]}
